<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MinistÃ©rio â€” Edson Luiz</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0d0d0f; --surface:#16161a; --surface2:#1e1e24; --surface3:#252530;
  --border:#2a2a35; --gold:#c9a84c; --gold2:#e8c97a; --gold3:rgba(201,168,76,0.12);
  --text:#e8e6e0; --muted:#7a7888; --accent:#7b4fc4;
  --red:#c44f4f; --green:#4fc47a; --ai:#5b9bd5; --ai2:#7eb8f0;
  --oai:#10a37f; --oai2:#34d399;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Source Sans 3',sans-serif;min-height:100vh;display:flex}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar{width:240px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;height:100vh;z-index:100}
.logo{padding:22px 20px 16px;border-bottom:1px solid var(--border)}
.logo-cross{font-size:20px;color:var(--gold);margin-bottom:4px}
.logo h1{font-family:'Playfair Display',serif;font-size:14px;font-weight:700;color:var(--gold2);letter-spacing:.05em;line-height:1.3}
.logo p{font-size:10px;color:var(--muted);margin-top:2px;letter-spacing:.12em;text-transform:uppercase}
nav{padding:10px 8px;flex:1;overflow-y:auto}
.nav-section{font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);padding:10px 10px 4px}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 10px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--muted);transition:all .2s;margin-bottom:1px;border:1px solid transparent}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{background:var(--gold3);color:var(--gold2);border-color:rgba(201,168,76,.2)}
.nav-item .icon{font-size:14px;width:17px;text-align:center}
.badge{margin-left:auto;background:var(--accent);color:#fff;font-size:10px;padding:2px 6px;border-radius:10px;font-weight:600}
.badge-new{margin-left:auto;background:rgba(16,163,127,.2);color:var(--oai2);font-size:9px;padding:2px 6px;border-radius:10px;font-weight:700;letter-spacing:.05em}
.sidebar-footer{padding:10px 12px;border-top:1px solid var(--border)}
.ai-status{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:8px;background:var(--surface2);border:1px solid var(--border);cursor:pointer;transition:all .2s}
.ai-status:hover{border-color:var(--ai)}
.ai-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);flex-shrink:0}
.ai-dot.connected{background:var(--green);box-shadow:0 0 6px rgba(79,196,122,.5)}
.ai-dot.oai{background:var(--oai2);box-shadow:0 0 6px rgba(52,211,153,.5)}
.ai-status-text{font-size:11px;color:var(--muted);flex:1}

/* â”€â”€ MAIN â”€â”€ */
.main{margin-left:240px;flex:1;display:flex;flex-direction:column;min-height:100vh}
.topbar{background:var(--surface);border-bottom:1px solid var(--border);padding:13px 26px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar h2{font-family:'Playfair Display',serif;font-size:20px;color:var(--text)}
.topbar-actions{display:flex;gap:7px}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{padding:7px 14px;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:600;font-family:'Source Sans 3',sans-serif;transition:all .2s;display:inline-flex;align-items:center;gap:5px}
.btn-primary{background:var(--gold);color:#0d0d0f}
.btn-primary:hover{background:var(--gold2)}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border)}
.btn-ghost:hover{color:var(--text);border-color:var(--muted)}
.btn-danger{background:rgba(196,79,79,.15);color:var(--red);border:1px solid rgba(196,79,79,.3)}
.btn-danger:hover{background:rgba(196,79,79,.25)}
.btn-edit{background:var(--gold3);color:var(--gold);border:1px solid rgba(201,168,76,.3)}
.btn-edit:hover{background:rgba(201,168,76,.2)}
.btn-ai{background:rgba(91,155,213,.15);color:var(--ai2);border:1px solid rgba(91,155,213,.3)}
.btn-ai:hover{background:rgba(91,155,213,.25)}
.btn-dup{background:rgba(123,79,196,.15);color:#a47be8;border:1px solid rgba(123,79,196,.3)}
.btn-dup:hover{background:rgba(123,79,196,.25)}
.btn-tp{background:rgba(0,0,0,.4);color:#fff;border:1px solid rgba(255,255,255,.2)}
.btn-tp:hover{background:rgba(255,255,255,.1)}
.btn-sm{padding:5px 10px;font-size:11px}
.btn-xs{padding:3px 7px;font-size:10px;border-radius:5px}

.content{padding:26px;flex:1}
.page{display:none}
.page.active{display:block}

/* â”€â”€ STATS â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),transparent)}
.stat-label{font-size:10px;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);margin-bottom:5px}
.stat-value{font-family:'Playfair Display',serif;font-size:28px;color:var(--gold2)}
.stat-sub{font-size:11px;color:var(--muted);margin-top:2px}

/* â”€â”€ CARDS â”€â”€ */
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.sermon-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer;transition:all .2s;position:relative}
.sermon-card:hover{border-color:var(--gold);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.4)}
.sermon-card-tag{display:inline-flex;align-items:center;gap:4px;font-size:9px;text-transform:uppercase;letter-spacing:.1em;padding:2px 7px;border-radius:4px;margin-bottom:8px;font-weight:700}
.tag-evangelismo{background:rgba(79,196,122,.15);color:var(--green)}
.tag-edificacao{background:rgba(123,79,196,.15);color:#a47be8}
.tag-jovens{background:rgba(201,168,76,.15);color:var(--gold)}
.tag-batismo{background:rgba(79,130,196,.15);color:#7baae8}
.tag-estudo{background:rgba(196,79,79,.15);color:var(--red)}
.sermon-card h3{font-family:'Playfair Display',serif;font-size:15px;margin-bottom:5px;line-height:1.3}
.sermon-card .meta{font-size:11px;color:var(--muted);margin-bottom:7px;display:flex;gap:10px;flex-wrap:wrap}
.sermon-card .verse{font-size:12px;color:var(--gold);font-style:italic;border-left:2px solid var(--gold);padding-left:8px;margin-bottom:8px}
.sermon-card .excerpt{font-size:12px;color:var(--muted);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.sermon-card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px;padding-top:8px;border-top:1px solid var(--border)}

/* â”€â”€ VERSIONS â”€â”€ */
.versions-panel{background:var(--surface2);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-top:16px}
.versions-panel-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.versions-panel-title{font-size:13px;font-weight:600;color:var(--text);display:flex;align-items:center;gap:8px}
.version-tab{padding:8px 14px;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);border:1px solid transparent;border-bottom:none;border-radius:8px 8px 0 0;transition:all .2s;background:transparent;font-family:'Source Sans 3',sans-serif;display:flex;align-items:center;gap:6px}
.version-tab:hover{color:var(--text);background:var(--surface3)}
.version-tab.active{color:var(--gold2);background:var(--surface);border-color:var(--border);border-bottom-color:var(--surface);position:relative;z-index:1}
.version-label{display:inline-block;font-size:9px;font-weight:700;letter-spacing:.05em;padding:1px 5px;border-radius:3px;background:var(--gold3);color:var(--gold)}
.version-label.v1{background:rgba(79,196,122,.15);color:var(--green)}
.version-label.v2{background:rgba(91,155,213,.15);color:var(--ai2)}
.version-label.v3{background:rgba(123,79,196,.15);color:#a47be8}
.version-label.v4{background:rgba(201,168,76,.15);color:var(--gold)}
.version-content-area{padding:18px;background:var(--surface);border-top:1px solid var(--border)}
.version-body{font-size:14px;line-height:1.9;color:var(--text);white-space:pre-wrap}
.version-actions{display:flex;gap:6px;margin-top:12px;padding-top:10px;border-top:1px solid var(--border);flex-wrap:wrap;align-items:center}

/* â”€â”€ EXTRA FIELDS â”€â”€ */
.extra-fields-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:14px}
.extra-field{display:flex;flex-direction:column;gap:4px}
.extra-field label{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
.extra-field .val{font-size:13px;color:var(--text)}
.extra-field .val.empty{color:var(--muted);font-style:italic}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;align-items:center;justify-content:center;padding:16px}
.modal-overlay.open{display:flex}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:100%;max-width:820px;max-height:94vh;overflow-y:auto;animation:slideUp .25s ease}
.modal-lg{max-width:1000px}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.modal-header{padding:18px 22px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--surface);z-index:10}
.modal-header h3{font-family:'Playfair Display',serif;font-size:18px}
.modal-close{background:none;border:none;color:var(--muted);font-size:18px;cursor:pointer;padding:4px;transition:color .2s}
.modal-close:hover{color:var(--text)}
.modal-body{padding:18px 22px}

/* â”€â”€ FORM â”€â”€ */
.form-grid{display:grid;gap:12px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.form-group{display:flex;flex-direction:column;gap:4px}
.form-group.full{grid-column:1/-1}
label{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
input,select,textarea{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:8px 11px;color:var(--text);font-family:'Source Sans 3',sans-serif;font-size:13px;transition:border-color .2s;width:100%}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--gold)}
select option{background:var(--surface2)}
textarea{resize:vertical;min-height:90px;line-height:1.7}
.editor-toolbar{display:flex;gap:3px;padding:6px 7px;background:var(--bg);border:1px solid var(--border);border-bottom:none;border-radius:8px 8px 0 0;flex-wrap:wrap}
.editor-toolbar button{background:none;border:1px solid transparent;color:var(--muted);padding:3px 7px;border-radius:4px;cursor:pointer;font-size:11px;transition:all .15s;font-family:'Source Sans 3',sans-serif}
.editor-toolbar button:hover{background:var(--surface2);color:var(--text);border-color:var(--border)}
.editor-area{background:var(--bg);border:1px solid var(--border);border-radius:0 0 8px 8px;padding:11px;min-height:200px;color:var(--text);font-size:13px;line-height:1.9;outline:none;font-family:'Source Sans 3',sans-serif;resize:vertical}
.editor-area:focus{border-color:var(--gold)}

/* â”€â”€ SEARCH & FILTER â”€â”€ */
.search-bar{display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px 13px;margin-bottom:16px}
.search-bar input{background:none;border:none;padding:0;flex:1;font-size:13px}
.search-bar input:focus{outline:none;border:none}
.filter-tabs{display:flex;gap:4px;margin-bottom:16px;flex-wrap:wrap}
.filter-tab{padding:5px 11px;border-radius:6px;font-size:12px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Source Sans 3',sans-serif;transition:all .2s}
.filter-tab:hover{color:var(--text);border-color:var(--muted)}
.filter-tab.active{background:var(--gold3);color:var(--gold);border-color:rgba(201,168,76,.4)}

/* â”€â”€ DETAIL â”€â”€ */
.detail-back{display:flex;align-items:center;gap:8px;color:var(--muted);cursor:pointer;font-size:13px;margin-bottom:16px;transition:color .2s}
.detail-back:hover{color:var(--gold)}
.detail-header{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px;margin-bottom:14px}
.detail-header h2{font-family:'Playfair Display',serif;font-size:24px;margin-bottom:10px;line-height:1.3}

/* â”€â”€ AI PANEL â”€â”€ */
.ai-panel{background:rgba(91,155,213,.05);border:1px solid rgba(91,155,213,.2);border-radius:12px;padding:14px 18px;margin-bottom:16px}
.ai-panel-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.ai-panel-title{font-size:13px;font-weight:600;color:var(--ai2)}
.ai-badge{font-size:9px;font-weight:700;background:rgba(91,155,213,.2);color:var(--ai2);padding:2px 6px;border-radius:4px;letter-spacing:.08em}
.ai-result{background:var(--surface2);border:1px solid rgba(91,155,213,.2);border-radius:8px;padding:13px;margin-top:10px;font-size:13px;line-height:1.8;color:var(--text);white-space:pre-wrap;display:none;max-height:340px;overflow-y:auto}
.ai-result.show{display:block}
.ai-thinking{display:none;align-items:center;gap:8px;margin-top:10px;color:var(--ai);font-size:12px}
.ai-thinking.show{display:flex}
.ai-spinner{width:14px;height:14px;border:2px solid rgba(91,155,213,.3);border-top-color:var(--ai2);border-radius:50%;animation:spin .8s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ SECTION TITLE â”€â”€ */
.section-title{font-family:'Playfair Display',serif;font-size:16px;color:var(--text);margin-bottom:12px;display:flex;align-items:center;gap:10px}
.section-title::after{content:'';flex:1;height:1px;background:var(--border)}
.empty-state{text-align:center;padding:48px 20px;color:var(--muted)}
.empty-state .empty-icon{font-size:40px;margin-bottom:8px}
.empty-state p{font-size:13px}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:20px;right:20px;background:var(--surface2);border:1px solid var(--gold);border-radius:10px;padding:11px 16px;font-size:13px;color:var(--gold2);z-index:9999;transform:translateY(100px);opacity:0;transition:all .3s;max-width:320px}
.toast.show{transform:translateY(0);opacity:1}

/* â”€â”€ EXPORT DROPDOWN â”€â”€ */
.export-menu{position:relative;display:inline-block}
.export-dropdown{display:none;position:absolute;top:calc(100% + 4px);right:0;background:var(--surface2);border:1px solid var(--border);border-radius:10px;min-width:190px;z-index:99;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.5)}
.export-dropdown.open{display:block}
.export-section-label{font-size:9px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);padding:7px 13px 3px}
.export-option{padding:8px 13px;font-size:12px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:8px;transition:background .15s}
.export-option:hover{background:var(--gold3);color:var(--gold)}
.export-option+.export-option{border-top:1px solid var(--border)}

/* â”€â”€ CONFIRM â”€â”€ */
.confirm-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:300;align-items:center;justify-content:center}
.confirm-overlay.open{display:flex}
.confirm-box{background:var(--surface);border:1px solid var(--red);border-radius:16px;padding:26px;max-width:380px;width:90%;text-align:center;animation:slideUp .25s ease}
.confirm-box h3{font-family:'Playfair Display',serif;font-size:18px;margin-bottom:7px}
.confirm-box p{font-size:13px;color:var(--muted);margin-bottom:20px}
.confirm-actions{display:flex;gap:10px;justify-content:center}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TELEPROMPTER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.teleprompter-overlay{
  display:none;position:fixed;inset:0;background:#000;z-index:1000;
  flex-direction:column;overflow:hidden;
}
.teleprompter-overlay.open{display:flex}
.tp-toolbar{
  position:fixed;top:0;left:0;right:0;padding:10px 20px;
  background:rgba(0,0,0,.85);backdrop-filter:blur(12px);
  display:flex;align-items:center;gap:12px;z-index:10;
  border-bottom:1px solid rgba(255,255,255,.08);
  flex-wrap:wrap;
}
.tp-title{font-size:13px;color:rgba(255,255,255,.5);flex:1;min-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tp-btn{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15);color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;font-family:'Source Sans 3',sans-serif;transition:all .2s;white-space:nowrap}
.tp-btn:hover{background:rgba(255,255,255,.2)}
.tp-btn.active{background:rgba(201,168,76,.3);border-color:var(--gold);color:var(--gold2)}
.tp-speed-display{font-size:13px;color:rgba(255,255,255,.6);min-width:60px;text-align:center}
.tp-progress{position:fixed;top:0;left:0;height:3px;background:var(--gold);z-index:11;transition:width .1s}
.tp-content-wrap{
  flex:1;overflow-y:auto;padding:80px 0 40px;
  scroll-behavior:smooth;
}
.tp-content-wrap::-webkit-scrollbar{display:none}
.tp-text{
  font-family:'Source Sans 3',sans-serif;
  font-size:var(--tp-size,52px);
  line-height:1.6;
  color:#fff;
  text-align:center;
  padding:40px 10vw;
  transition:font-size .2s;
  cursor:default;
  user-select:none;
}
.tp-text.mirrored{transform:scaleX(-1)}
.tp-text p{margin-bottom:.6em}
.tp-text .tp-highlight{background:rgba(201,168,76,.2);border-radius:4px;padding:0 4px}
.tp-overlay-hint{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
  background:rgba(0,0,0,.7);color:rgba(255,255,255,.4);
  font-size:11px;padding:8px 16px;border-radius:20px;
  letter-spacing:.06em;pointer-events:none;
  animation:fadeHint 4s ease forwards;
}
@keyframes fadeHint{0%{opacity:1}70%{opacity:1}100%{opacity:0}}

/* â”€â”€ LOCATION / STUDY / PHOTO â”€â”€ */
.location-item{display:flex;align-items:center;gap:12px;padding:11px 13px;background:var(--surface);border:1px solid var(--border);border-radius:10px;margin-bottom:6px}
.location-icon{font-size:18px}
.location-info h4{font-size:13px;font-weight:600}
.location-info p{font-size:11px;color:var(--muted)}
.location-count{margin-left:auto;font-size:12px;color:var(--gold);font-weight:600}
.study-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer;transition:all .2s}
.study-card:hover{border-color:var(--gold)}
.study-card h4{font-family:'Playfair Display',serif;font-size:14px;margin-bottom:4px}
.study-card p{font-size:12px;color:var(--muted);line-height:1.5}
.study-card .tags{display:flex;gap:5px;margin-top:8px;flex-wrap:wrap}
.photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:7px;margin-top:12px}
.photo-item{aspect-ratio:1;border-radius:8px;background:var(--surface2);border:1px solid var(--border);overflow:hidden;cursor:pointer}
.photo-item img{width:100%;height:100%;object-fit:cover}
.upload-area{border:2px dashed var(--border);border-radius:12px;padding:26px;text-align:center;cursor:pointer;transition:all .2s;color:var(--muted)}
.upload-area:hover{border-color:var(--gold);color:var(--text);background:var(--gold3)}
.upload-icon{font-size:26px;margin-bottom:7px}

/* â”€â”€ PROVIDER TABS â”€â”€ */
.provider-tab-row{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border)}
.provider-tab{padding:9px 18px;font-size:13px;font-weight:600;cursor:pointer;color:var(--muted);border:none;background:transparent;border-bottom:2px solid transparent;transition:all .2s;font-family:'Source Sans 3',sans-serif}
.provider-tab:hover{color:var(--text)}
.provider-tab.active-claude{color:var(--ai2);border-bottom-color:var(--ai2)}
.provider-tab.active-oai{color:var(--oai2);border-bottom-color:var(--oai2)}
.provider-panel{display:none}
.provider-panel.active{display:block}
.api-key-box{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px}
.api-key-box p{font-size:13px;color:var(--muted);margin-bottom:10px;line-height:1.7}
.api-key-input-row{display:flex;gap:7px}
.api-key-input-row input{flex:1;font-family:monospace;font-size:12px}
.model-select-row{display:flex;gap:7px;margin-top:8px;align-items:center}
.model-select-row label{font-size:11px;color:var(--muted);white-space:nowrap;text-transform:none;letter-spacing:0}
.model-select-row select{flex:1;font-size:12px}
.cost-note{font-size:11px;color:var(--green);margin-top:6px;padding:6px 10px;background:rgba(79,196,122,.07);border-radius:6px;border:1px solid rgba(79,196,122,.15)}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--muted)}

@media(max-width:900px){
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .form-row,.form-row-3{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-cross">âœ</div>
    <h1>MinistÃ©rio<br>Edson Luiz</h1>
    <p>GestÃ£o Ministerial</p>
  </div>
  <nav>
    <div class="nav-section">Principal</div>
    <div class="nav-item active" onclick="showPage('dashboard')"><span class="icon">âŠ</span> Dashboard</div>
    <div class="nav-item" onclick="showPage('sermons')"><span class="icon">ğŸ“–</span> Mensagens <span class="badge" id="sermon-count">0</span></div>
    <div class="nav-item" onclick="showPage('new-sermon')"><span class="icon">âœï¸</span> Nova Mensagem</div>
    <div class="nav-section">IA & Ferramentas</div>
    <div class="nav-item" onclick="showPage('ai-studio')"><span class="icon">ğŸ¤–</span> EstÃºdio IA <span class="badge-new">GPT+Claude</span></div>
    <div class="nav-section">OrganizaÃ§Ã£o</div>
    <div class="nav-item" onclick="showPage('locations')"><span class="icon">ğŸ“</span> Locais</div>
    <div class="nav-item" onclick="showPage('studies')"><span class="icon">ğŸ“š</span> Estudos</div>
    <div class="nav-item" onclick="showPage('photos')"><span class="icon">ğŸ–¼ï¸</span> Fotos</div>
  </nav>
  <div class="sidebar-footer">
    <div class="ai-status" onclick="openModal('api-key-modal')" title="Configurar IA">
      <div class="ai-dot" id="ai-dot"></div>
      <span class="ai-status-text" id="ai-status-text">IA â€” configurar</span>
      <span style="font-size:11px;color:var(--muted)">âš™</span>
    </div>
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="main">
  <div class="topbar">
    <h2 id="page-title">Dashboard</h2>
    <div class="topbar-actions">
      <button class="btn btn-ghost btn-sm" onclick="document.getElementById('import-json').click()">â†‘ Importar</button>
      <input type="file" id="import-json" accept=".json" style="display:none" onchange="importData(this)">
      <button class="btn btn-ghost btn-sm" onclick="exportAllData()">ğŸ’¾ Backup Geral</button>
      <button class="btn btn-primary btn-sm" onclick="showPage('new-sermon')">+ Nova Mensagem</button>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD -->
    <div id="page-dashboard" class="page active">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Total de Mensagens</div><div class="stat-value" id="stat-total">0</div><div class="stat-sub">PregaÃ§Ãµes registradas</div></div>
        <div class="stat-card"><div class="stat-label">Locais Ministrados</div><div class="stat-value" id="stat-locations">0</div><div class="stat-sub">Igrejas e eventos</div></div>
        <div class="stat-card"><div class="stat-label">Estudos Ativos</div><div class="stat-value" id="stat-studies">0</div><div class="stat-sub">Em desenvolvimento</div></div>
        <div class="stat-card"><div class="stat-label">Este MÃªs</div><div class="stat-value" id="stat-month">0</div><div class="stat-sub">PregaÃ§Ãµes no mÃªs</div></div>
      </div>
      <div class="section-title">âœ Ãšltimas Mensagens</div>
      <div class="card-grid" id="dashboard-recent"></div>
    </div>

    <!-- SERMONS LIST -->
    <div id="page-sermons" class="page">
      <div class="search-bar"><span>ğŸ”</span><input type="text" placeholder="Buscar tÃ­tulo, versÃ­culo, local, conteÃºdo..." oninput="filterSermons(this.value)" id="sermon-search"></div>
      <div class="filter-tabs">
        <button class="filter-tab active" onclick="setFilter('all',this)">Todas</button>
        <button class="filter-tab" onclick="setFilter('evangelismo',this)">Evangelismo</button>
        <button class="filter-tab" onclick="setFilter('edificacao',this)">EdificaÃ§Ã£o</button>
        <button class="filter-tab" onclick="setFilter('jovens',this)">Jovens</button>
        <button class="filter-tab" onclick="setFilter('batismo',this)">Batismo</button>
        <button class="filter-tab" onclick="setFilter('estudo',this)">Estudo</button>
      </div>
      <div class="card-grid" id="sermons-grid"></div>
    </div>

    <!-- SERMON DETAIL -->
    <div id="page-sermon-detail" class="page">
      <div class="detail-back" onclick="showPage('sermons')">â† Voltar para mensagens</div>
      <div class="detail-header" id="detail-header"></div>
      <div id="extra-fields-display"></div>
      <div class="versions-panel" id="versions-panel">
        <div class="versions-panel-header">
          <div class="versions-panel-title">ğŸ“„ VersÃµes da Mensagem</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap">
            <button class="btn btn-ai btn-sm" onclick="openAiVersionModal()">ğŸ¤– Gerar com IA</button>
            <button class="btn btn-ghost btn-sm" onclick="addVersionManual()">+ Nova VersÃ£o</button>
          </div>
        </div>
        <div style="border-bottom:1px solid var(--border);overflow-x:auto">
          <div style="display:flex;padding:0 14px;gap:0" id="version-tabs-row"></div>
        </div>
        <div class="version-content-area" id="version-content-area">
          <div class="version-body" id="version-body-display"></div>
          <div class="version-actions" id="version-actions"></div>
        </div>
      </div>
      <div id="detail-notes" style="margin-top:14px;display:none;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px"></div>
    </div>

    <!-- NEW SERMON -->
    <div id="page-new-sermon" class="page">
      <div style="background:rgba(201,168,76,.07);border:1px solid rgba(201,168,76,.2);border-radius:12px;padding:16px;margin-bottom:18px">
        <div style="font-size:13px;font-weight:600;color:var(--gold2);margin-bottom:4px">ğŸ“‹ Importar texto do Word, PDF ou WhatsApp</div>
        <textarea id="paste-raw" placeholder="Cole o texto completo aqui..." style="min-height:70px;margin-bottom:8px"></textarea>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn btn-primary btn-sm" onclick="parseRawText()">âš¡ Distribuir nos campos</button>
          <span style="font-size:11px;color:var(--muted)">Ajuste depois nos campos abaixo</span>
        </div>
      </div>
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group"><label>TÃ­tulo da Mensagem *</label><input type="text" id="f-title" placeholder="Ex: A ForÃ§a do EspÃ­rito Santo"></div>
          <div class="form-group"><label>Texto BÃ­blico Principal</label><input type="text" id="f-verse" placeholder="Ex: Atos 2:1-4"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Data da PregaÃ§Ã£o</label><input type="date" id="f-date"></div>
          <div class="form-group"><label>Local / Igreja</label><input type="text" id="f-location" placeholder="Ex: Igreja Assembleia Central"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Categoria</label>
            <select id="f-category">
              <option value="evangelismo">Evangelismo</option><option value="edificacao">EdificaÃ§Ã£o</option>
              <option value="jovens">Jovens</option><option value="batismo">Batismo</option><option value="estudo">Estudo BÃ­blico</option>
            </select>
          </div>
          <div class="form-group"><label>Nome da VersÃ£o</label><input type="text" id="f-version" placeholder="Ex: V1 â€” Original"></div>
        </div>
        <div class="form-group full"><label>Tema Central / IntroduÃ§Ã£o</label><input type="text" id="f-theme" placeholder="Resumo do tema central"></div>

        <!-- â”€â”€ CAMPOS EXTRAS â”€â”€ -->
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px">
          <div style="font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:10px">Campos Adicionais</div>
          <div class="form-row">
            <div class="form-group"><label>â± Tempo Estimado</label><input type="text" id="f-duration" placeholder="Ex: 35 min"></div>
            <div class="form-group"><label>ğŸ¯ Objetivo Principal</label><input type="text" id="f-objective" placeholder="Ex: Fortalecer a fÃ© dos membros"></div>
          </div>
          <div class="form-group full" style="margin-top:8px"><label>ğŸ“£ Chamada / Apelo Final</label><textarea id="f-appeal" placeholder="Escreva o apelo que serÃ¡ feito ao final da mensagem..." style="min-height:70px"></textarea></div>
          <div class="form-group full" style="margin-top:8px"><label>ğŸ“‘ Texto ARC / NAA (PadrÃ£o)</label><textarea id="f-arc" placeholder="Texto base na versÃ£o ARC/NAA para referÃªncia..." style="min-height:60px"></textarea></div>
        </div>

        <div class="form-group full">
          <label>Corpo da Mensagem</label>
          <div class="editor-toolbar">
            <button onclick="insertText('ğŸ“Œ PONTO: ')">ğŸ“Œ Ponto</button>
            <button onclick="insertText('\n\nğŸ”¥ CLÃMAX: ')">ğŸ”¥ ClÃ­max</button>
            <button onclick="insertText('\n\nğŸ’¡ ILUSTRAÃ‡ÃƒO: ')">ğŸ’¡ IlustraÃ§Ã£o</button>
            <button onclick="insertText('\n\nğŸ“£ APELO: ')">ğŸ“£ Apelo</button>
            <button onclick="insertText('\n\nğŸ™ ORAÃ‡ÃƒO: ')">ğŸ™ OraÃ§Ã£o</button>
            <button onclick="insertText('\nâ‘  ')">â‘ </button>
            <button onclick="insertText('\nâ‘¡ ')">â‘¡</button>
            <button onclick="insertText('\nâ‘¢ ')">â‘¢</button>
          </div>
          <textarea class="editor-area" id="f-body" placeholder="Desenvolva o corpo da mensagem..."></textarea>
        </div>
        <div class="form-group full"><label>Notas Pessoais</label><textarea id="f-notes" placeholder="ReaÃ§Ãµes da congregaÃ§Ã£o, insights..." style="min-height:70px"></textarea></div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:4px">
          <button class="btn btn-ghost" onclick="showPage('sermons')">Cancelar</button>
          <button class="btn btn-primary" onclick="saveSermon()">âœ“ Salvar Mensagem</button>
        </div>
      </div>
    </div>

    <!-- AI STUDIO -->
    <div id="page-ai-studio" class="page">
      <div class="ai-panel" style="margin-bottom:20px">
        <div class="ai-panel-header"><span style="font-size:22px">ğŸ¤–</span>
          <div><div class="ai-panel-title">EstÃºdio de IA <span class="ai-badge">Claude + ChatGPT</span></div>
          <div style="font-size:12px;color:var(--muted)">Use o melhor dos dois mundos para suas mensagens</div></div>
        </div>
        <button class="btn btn-ai btn-sm" onclick="openModal('api-key-modal')">âš™ Configurar APIs</button>
      </div>
      <div class="section-title">âœ¨ Ferramentas</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px">
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer" onclick="aiTool('sermon-outline')"><div style="font-size:22px;margin-bottom:8px">ğŸ“</div><div style="font-size:14px;font-weight:600;margin-bottom:4px">Gerar EsboÃ§o</div><div style="font-size:12px;color:var(--muted)">EsboÃ§o completo a partir de um tema ou versÃ­culo.</div></div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer" onclick="aiTool('introduction')"><div style="font-size:22px;margin-bottom:8px">ğŸ¯</div><div style="font-size:14px;font-weight:600;margin-bottom:4px">IntroduÃ§Ã£o Impactante</div><div style="font-size:12px;color:var(--muted)">3 opÃ§Ãµes de abertura poderosa.</div></div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer" onclick="aiTool('illustration')"><div style="font-size:22px;margin-bottom:8px">ğŸ’¡</div><div style="font-size:14px;font-weight:600;margin-bottom:4px">Sugerir IlustraÃ§Ãµes</div><div style="font-size:12px;color:var(--muted)">HistÃ³rias e analogias para seu ponto.</div></div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer" onclick="aiTool('verses')"><div style="font-size:22px;margin-bottom:8px">ğŸ“–</div><div style="font-size:14px;font-weight:600;margin-bottom:4px">VersÃ­culos Relacionados</div><div style="font-size:12px;color:var(--muted)">Textos bÃ­blicos complementares.</div></div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer" onclick="aiTool('appeal')"><div style="font-size:22px;margin-bottom:8px">ğŸ“£</div><div style="font-size:14px;font-weight:600;margin-bottom:4px">Criar Apelo Final</div><div style="font-size:12px;color:var(--muted)">Convite e oraÃ§Ã£o de encerramento.</div></div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer" onclick="aiTool('improve')"><div style="font-size:22px;margin-bottom:8px">âœ¨</div><div style="font-size:14px;font-weight:600;margin-bottom:4px">Melhorar Texto</div><div style="font-size:12px;color:var(--muted)">Reescreva um trecho com mais fluidez.</div></div>
      </div>
    </div>

    <!-- LOCATIONS -->
    <div id="page-locations" class="page">
      <div class="section-title">ğŸ“ Locais Ministrados</div>
      <div id="locations-list"><div class="empty-state"><div class="empty-icon">ğŸ“</div><p>Nenhum local registrado.</p></div></div>
    </div>

    <!-- STUDIES -->
    <div id="page-studies" class="page">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <div class="section-title" style="flex:1;margin-bottom:0">ğŸ“š Estudos BÃ­blicos</div>
        <button class="btn btn-primary btn-sm" onclick="openModal('study-modal')">+ Novo Estudo</button>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px" id="studies-grid">
        <div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">ğŸ“š</div><p>Nenhum estudo ainda.</p></div>
      </div>
    </div>

    <!-- PHOTOS -->
    <div id="page-photos" class="page">
      <div class="section-title">ğŸ–¼ï¸ Galeria Ministerial</div>
      <div class="upload-area" onclick="document.getElementById('photo-input').click()">
        <div class="upload-icon">ğŸ“·</div><p>Clique para adicionar fotos</p>
        <input type="file" id="photo-input" accept="image/*" multiple style="display:none" onchange="handlePhotos(this)">
      </div>
      <div class="photo-grid" id="photo-grid"></div>
    </div>

  </div><!-- /content -->
</main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• TELEPROMPTER â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="teleprompter-overlay" id="tp-overlay">
  <div class="tp-toolbar">
    <div class="tp-title" id="tp-title">Teleprompter</div>
    <button class="tp-btn" id="tp-play-btn" onclick="tpTogglePlay()">â–¶ Iniciar</button>
    <button class="tp-btn" onclick="tpSlower()">ğŸ¢ âˆ’</button>
    <div class="tp-speed-display" id="tp-speed-display">Vel: 1.0</div>
    <button class="tp-btn" onclick="tpFaster()">ğŸ‡ +</button>
    <button class="tp-btn" onclick="tpFontDown()">Aâˆ’</button>
    <button class="tp-btn" onclick="tpFontUp()">A+</button>
    <button class="tp-btn" id="tp-mirror-btn" onclick="tpToggleMirror()">â†” Espelhar</button>
    <button class="tp-btn" onclick="tpRestart()">â†º Reiniciar</button>
    <button class="tp-btn" onclick="closeTeleprompter()" style="background:rgba(196,79,79,.3);border-color:var(--red)">âœ• Fechar</button>
  </div>
  <div class="tp-progress" id="tp-progress"></div>
  <div class="tp-content-wrap" id="tp-scroll">
    <div class="tp-text" id="tp-text"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- EDIT MODAL -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <div class="modal-header"><h3>âœï¸ Editar Mensagem</h3><button class="modal-close" onclick="closeModal('edit-modal')">âœ•</button></div>
    <div class="modal-body">
      <input type="hidden" id="edit-id">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group"><label>TÃ­tulo</label><input type="text" id="edit-title"></div>
          <div class="form-group"><label>Texto BÃ­blico</label><input type="text" id="edit-verse"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Data</label><input type="date" id="edit-date"></div>
          <div class="form-group"><label>Local</label><input type="text" id="edit-location"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Categoria</label>
            <select id="edit-category">
              <option value="evangelismo">Evangelismo</option><option value="edificacao">EdificaÃ§Ã£o</option>
              <option value="jovens">Jovens</option><option value="batismo">Batismo</option><option value="estudo">Estudo</option>
            </select>
          </div>
          <div class="form-group"><label>Tema</label><input type="text" id="edit-theme"></div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px" class="full">
          <div style="font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px">Campos Adicionais</div>
          <div class="form-row">
            <div class="form-group"><label>â± Tempo Estimado</label><input type="text" id="edit-duration" placeholder="Ex: 35 min"></div>
            <div class="form-group"><label>ğŸ¯ Objetivo</label><input type="text" id="edit-objective"></div>
          </div>
          <div class="form-group full" style="margin-top:8px"><label>ğŸ“£ Apelo Final</label><textarea id="edit-appeal" style="min-height:60px"></textarea></div>
          <div class="form-group full" style="margin-top:8px"><label>ğŸ“‘ Texto ARC/NAA</label><textarea id="edit-arc" style="min-height:50px"></textarea></div>
        </div>
        <div class="form-group full"><label>Corpo (VersÃ£o Atual)</label><textarea id="edit-body" style="min-height:200px"></textarea></div>
        <div class="form-group full"><label>Notas Pessoais</label><textarea id="edit-notes" style="min-height:60px"></textarea></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn btn-ghost" onclick="closeModal('edit-modal')">Cancelar</button>
          <button class="btn btn-primary" onclick="saveEdit()">âœ“ Salvar AlteraÃ§Ãµes</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ADD VERSION MANUAL -->
<div class="modal-overlay" id="add-version-modal">
  <div class="modal">
    <div class="modal-header"><h3>ğŸ“„ Nova VersÃ£o da Mensagem</h3><button class="modal-close" onclick="closeModal('add-version-modal')">âœ•</button></div>
    <div class="modal-body">
      <input type="hidden" id="av-sermon-id">
      <div class="form-grid">
        <div class="form-group"><label>Nome da VersÃ£o</label><input type="text" id="av-name" placeholder="Ex: V2 â€” Revisada, V3 â€” Jovens..."></div>
        <div class="form-group full">
          <label>ConteÃºdo</label>
          <div class="editor-toolbar">
            <button onclick="insertAvText('ğŸ“Œ PONTO: ')">ğŸ“Œ</button>
            <button onclick="insertAvText('\n\nğŸ”¥ CLÃMAX: ')">ğŸ”¥</button>
            <button onclick="insertAvText('\n\nğŸ’¡ ILUSTRAÃ‡ÃƒO: ')">ğŸ’¡</button>
            <button onclick="insertAvText('\n\nğŸ“£ APELO: ')">ğŸ“£</button>
          </div>
          <textarea class="editor-area" id="av-body" style="min-height:260px"></textarea>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn btn-ghost" onclick="closeModal('add-version-modal')">Cancelar</button>
          <button class="btn btn-primary" onclick="saveNewVersion()">âœ“ Salvar VersÃ£o</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- AI VERSION MODAL -->
<div class="modal-overlay" id="ai-version-modal">
  <div class="modal">
    <div class="modal-header"><h3>ğŸ¤– Gerar Nova VersÃ£o com IA</h3><button class="modal-close" onclick="closeModal('ai-version-modal')">âœ•</button></div>
    <div class="modal-body">
      <input type="hidden" id="aiv-sermon-id">
      <div class="ai-panel" style="margin-bottom:12px">
        <div style="font-size:12px;color:var(--muted);line-height:1.7">O <strong style="color:var(--ai2)">Claude</strong> ou <strong style="color:var(--oai2)">ChatGPT</strong> vai ler sua mensagem e criar uma nova versÃ£o. A original Ã© preservada.</div>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nome da Nova VersÃ£o</label><input type="text" id="aiv-name" placeholder="Ex: V2 â€” Simplificada para Jovens"></div>
        <div class="form-group full">
          <label>InstruÃ§Ã£o</label>
          <select id="aiv-preset" onchange="applyAiPreset(this.value)" style="margin-bottom:7px">
            <option value="">â€” Escolha um preset ou escreva sua instruÃ§Ã£o â€”</option>
            <option value="simplify">Simplificar (jovens / crianÃ§as)</option>
            <option value="expand">Expandir e aprofundar</option>
            <option value="shorten">Resumir para 15 minutos</option>
            <option value="evangelical">Adaptar para culto evangelÃ­stico</option>
            <option value="devotional">Transformar em devocional</option>
            <option value="outline">Extrair esboÃ§o com pontos</option>
          </select>
          <textarea id="aiv-instruction" placeholder="Descreva como adaptar esta mensagem..." style="min-height:90px"></textarea>
        </div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <button class="btn btn-ai" id="aiv-btn" onclick="generateAiVersion()">ğŸ¤– Gerar com IA</button>
          <button class="btn btn-ghost btn-sm" onclick="closeModal('ai-version-modal')">Cancelar</button>
        </div>
        <div class="ai-thinking" id="aiv-thinking"><div class="ai-spinner"></div><span id="aiv-thinking-text">Gerando versÃ£o...</span></div>
        <div class="ai-result" id="aiv-result"></div>
        <div id="aiv-save-row" style="display:none;gap:8px;margin-top:8px">
          <button class="btn btn-primary btn-sm" onclick="saveAiVersion()">âœ“ Salvar esta VersÃ£o</button>
          <button class="btn btn-ghost btn-sm" onclick="copyAiResult('aiv-result')">ğŸ“‹ Copiar</button>
          <button class="btn btn-ghost btn-sm" onclick="generateAiVersion()">â†º Gerar novamente</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- AI TOOL MODAL -->
<div class="modal-overlay" id="ai-tool-modal">
  <div class="modal modal-lg">
    <div class="modal-header"><h3 id="ai-tool-modal-title">ğŸ¤– Ferramenta IA</h3><button class="modal-close" onclick="closeModal('ai-tool-modal')">âœ•</button></div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label id="ai-tool-modal-label">Entrada</label><textarea id="ai-tool-modal-input" style="min-height:90px"></textarea></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <button class="btn btn-ai" onclick="runAiTool()">ğŸ¤– Gerar</button>
          <button class="btn btn-ghost btn-sm" onclick="closeModal('ai-tool-modal')">Fechar</button>
          <span id="ai-tool-provider-badge" style="font-size:11px;color:var(--muted)"></span>
        </div>
        <div class="ai-thinking" id="ai-tool-thinking"><div class="ai-spinner"></div><span>Gerando...</span></div>
        <div class="ai-result" id="ai-tool-result"></div>
        <div id="ai-tool-result-actions" style="display:none;gap:8px;margin-top:8px">
          <button class="btn btn-primary btn-sm" onclick="copyAiResult('ai-tool-result')">ğŸ“‹ Copiar</button>
          <button class="btn btn-ghost btn-sm" onclick="sendToolResultToNew()">â†’ Usar na Nova Mensagem</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- STUDY MODAL -->
<div class="modal-overlay" id="study-modal">
  <div class="modal">
    <div class="modal-header"><h3>ğŸ“š Novo Estudo BÃ­blico</h3><button class="modal-close" onclick="closeModal('study-modal')">âœ•</button></div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-group"><label>TÃ­tulo</label><input type="text" id="sf-title"></div>
          <div class="form-group"><label>Passagem Base</label><input type="text" id="sf-passage"></div>
        </div>
        <div class="form-group full"><label>Desenvolvimento</label><textarea id="sf-content" style="min-height:160px"></textarea></div>
        <div class="form-group full"><label>Tags</label><input type="text" id="sf-tags" placeholder="Ex: EspÃ­rito Santo, Dons"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn btn-ghost" onclick="closeModal('study-modal')">Cancelar</button>
          <button class="btn btn-primary" onclick="saveStudy()">âœ“ Salvar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- API KEY MODAL -->
<div class="modal-overlay" id="api-key-modal">
  <div class="modal" style="max-width:560px">
    <div class="modal-header"><h3>ğŸ¤– Configurar InteligÃªncia Artificial</h3><button class="modal-close" onclick="closeModal('api-key-modal')">âœ•</button></div>
    <div class="modal-body">
      <!-- Provider Tabs -->
      <div class="provider-tab-row">
        <button class="provider-tab active-oai" id="tab-oai" onclick="switchProviderTab('oai')">ğŸ’š ChatGPT (OpenAI)</button>
        <button class="provider-tab" id="tab-claude" onclick="switchProviderTab('claude')">ğŸ”µ Claude (Anthropic)</button>
      </div>

      <!-- OpenAI Panel -->
      <div class="provider-panel active" id="panel-oai">
        <div class="api-key-box">
          <p>Cole sua chave da OpenAI. Obtenha em: <a href="https://platform.openai.com/api-keys" target="_blank" style="color:var(--oai2)">platform.openai.com/api-keys</a></p>
          <div class="api-key-input-row">
            <input type="password" id="oai-key-input" placeholder="sk-proj-..." autocomplete="off">
            <button class="btn btn-primary btn-sm" onclick="saveOAIKey()" style="background:var(--oai)">Salvar</button>
          </div>
          <div class="model-select-row">
            <label>Modelo:</label>
            <select id="oai-model-select">
              <option value="gpt-4o-mini">GPT-4o Mini â€” rÃ¡pido e baratÃ­ssimo âœ…</option>
              <option value="gpt-4o">GPT-4o â€” mais inteligente</option>
              <option value="gpt-4.1-mini">GPT-4.1 Mini â€” novo e eficiente</option>
            </select>
          </div>
          <div class="cost-note">ğŸ’° GPT-4o Mini: ~R$ 0,002 por sermÃ£o gerado. Muito barato para uso diÃ¡rio.</div>
          <div style="display:flex;gap:7px;margin-top:10px">
            <button class="btn btn-ghost btn-sm" onclick="testOAIKey()">ğŸ” Testar</button>
            <button class="btn btn-danger btn-sm" onclick="clearOAIKey()">ğŸ—‘ Remover</button>
          </div>
          <div id="oai-key-status" style="margin-top:8px;font-size:12px;color:var(--muted)"></div>
        </div>
      </div>

      <!-- Claude Panel -->
      <div class="provider-panel" id="panel-claude">
        <div class="api-key-box">
          <p>Cole sua chave da Anthropic. Obtenha em: <a href="https://console.anthropic.com" target="_blank" style="color:var(--ai2)">console.anthropic.com</a></p>
          <div class="api-key-input-row">
            <input type="password" id="claude-key-input" placeholder="sk-ant-api03-..." autocomplete="off">
            <button class="btn btn-ai btn-sm" onclick="saveClaudeKey()">Salvar</button>
          </div>
          <div class="model-select-row">
            <label>Modelo:</label>
            <select id="claude-model-select">
              <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5 â€” rÃ¡pido e baratÃ­ssimo âœ…</option>
              <option value="claude-sonnet-4-20250514">Claude Sonnet 4.5 â€” mais inteligente</option>
            </select>
          </div>
          <div class="cost-note">ğŸ’° Haiku 4.5: ~R$ 0,01 por sermÃ£o gerado. Excelente custo-benefÃ­cio.</div>
          <div style="display:flex;gap:7px;margin-top:10px">
            <button class="btn btn-ghost btn-sm" onclick="testClaudeKey()">ğŸ” Testar</button>
            <button class="btn btn-danger btn-sm" onclick="clearClaudeKey()">ğŸ—‘ Remover</button>
          </div>
          <div id="claude-key-status" style="margin-top:8px;font-size:12px;color:var(--muted)"></div>
        </div>
      </div>

      <!-- Active provider select -->
      <div style="margin-top:16px;padding:12px;background:var(--surface2);border-radius:10px;border:1px solid var(--border)">
        <div style="font-size:12px;color:var(--muted);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:.08em">IA Ativa para GeraÃ§Ã£o</div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-sm" id="active-oai-btn" onclick="setActiveProvider('oai')" style="flex:1">ğŸ’š ChatGPT</button>
          <button class="btn btn-sm" id="active-claude-btn" onclick="setActiveProvider('claude')" style="flex:1">ğŸ”µ Claude</button>
        </div>
        <div id="active-provider-display" style="font-size:12px;color:var(--muted);margin-top:8px;text-align:center"></div>
      </div>
    </div>
  </div>
</div>

<!-- CONFIRM DELETE -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <h3>ğŸ—‘ Excluir Mensagem</h3>
    <p>Excluir permanentemente? Todas as versÃµes serÃ£o perdidas.</p>
    <div class="confirm-actions">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancelar</button>
      <button class="btn btn-danger" id="confirm-delete-btn">Sim, excluir</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ DATA â”€â”€
let data = JSON.parse(localStorage.getItem('ministerio')||'{"sermons":[],"studies":[],"photos":[]}');
let currentFilter='all', currentSearch='', currentSermonId=null, currentVersionIdx=0;
let _pendingDeleteId=null, _currentAiToolKey='';

function save(){ localStorage.setItem('ministerio',JSON.stringify(data)); }

// â”€â”€ TOAST â”€â”€
function showToast(msg,dur=3000){
  const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
  clearTimeout(t._t); t._t=setTimeout(()=>t.classList.remove('show'),dur);
}

// â”€â”€ NAV â”€â”€
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const titles={dashboard:'Dashboard',sermons:'Mensagens','new-sermon':'Nova Mensagem','sermon-detail':'Mensagem',locations:'Locais',studies:'Estudos BÃ­blicos',photos:'Galeria','ai-studio':'EstÃºdio IA'};
  document.getElementById('page-title').textContent=titles[id]||'';
  if(id==='dashboard') renderDashboard();
  if(id==='sermons') renderSermons();
  if(id==='locations') renderLocations();
  if(id==='studies') renderStudies();
  if(id==='new-sermon'){ clearForm(); document.getElementById('f-date').value=new Date().toISOString().split('T')[0]; }
}

// â”€â”€ MODALS â”€â”€
function openModal(id){ document.getElementById(id).classList.add('open'); }
function closeModal(id){ document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)closeModal(m.id);}));

// â”€â”€ FORM â”€â”€
function clearForm(){
  ['f-title','f-verse','f-location','f-version','f-theme','f-body','f-notes','f-duration','f-objective','f-appeal','f-arc','paste-raw'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('f-category').value='evangelismo';
  document.getElementById('f-version').value='V1 â€” Original';
}
function insertText(txt){ const ta=document.getElementById('f-body'); const p=ta.selectionStart; ta.value=ta.value.substring(0,p)+txt+ta.value.substring(p); ta.selectionStart=ta.selectionEnd=p+txt.length; ta.focus(); }
function insertAvText(txt){ const ta=document.getElementById('av-body'); const p=ta.selectionStart; ta.value=ta.value.substring(0,p)+txt+ta.value.substring(p); ta.selectionStart=ta.selectionEnd=p+txt.length; ta.focus(); }

// â”€â”€ SAVE SERMON â”€â”€
function saveSermon(){
  const title=document.getElementById('f-title').value.trim();
  if(!title){showToast('âš ï¸ Informe o tÃ­tulo.');return;}
  const body=document.getElementById('f-body').value.trim();
  const vName=document.getElementById('f-version').value.trim()||'V1 â€” Original';
  const sermon={
    id:Date.now(), title,
    verse:document.getElementById('f-verse').value.trim(),
    date:document.getElementById('f-date').value,
    location:document.getElementById('f-location').value.trim(),
    category:document.getElementById('f-category').value,
    theme:document.getElementById('f-theme').value.trim(),
    body, notes:document.getElementById('f-notes').value.trim(),
    duration:document.getElementById('f-duration').value.trim(),
    objective:document.getElementById('f-objective').value.trim(),
    appeal:document.getElementById('f-appeal').value.trim(),
    arc:document.getElementById('f-arc').value.trim(),
    versions:[{name:vName,date:new Date().toISOString(),body}]
  };
  data.sermons.unshift(sermon); save(); updateBadge();
  showToast('âœ Mensagem salva!'); showPage('sermons');
}
function updateBadge(){ document.getElementById('sermon-count').textContent=data.sermons.length; }

// â”€â”€ PARSE RAW â”€â”€
function parseRawText(){
  const raw=document.getElementById('paste-raw').value.trim();
  if(!raw){showToast('âš ï¸ Cole algum texto primeiro.');return;}
  const lines=raw.split('\n').map(l=>l.trim()).filter(Boolean);
  if(!lines.length)return;
  document.getElementById('f-title').value=lines[0].substring(0,120);
  const vRx=/([1-3]?\s?[A-Za-zÃ€-Ãº]+\.?\s?\d+\s?:\s?\d+[\s\-â€“â€”\d,;]*)/;
  let verse=''; for(const l of lines){const m=l.match(vRx);if(m){verse=m[0].trim();break;}}
  if(verse) document.getElementById('f-verse').value=verse;
  const dRx=/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/;
  for(const l of lines){const m=l.match(dRx);if(m){document.getElementById('f-date').value=`${m[3]}-${m[2]}-${m[1]}`;break;}}
  const sl=lines.find((l,i)=>i>0&&l!==verse&&l.length<160);
  if(sl) document.getElementById('f-theme').value=sl;
  document.getElementById('f-body').value=lines.slice(1).join('\n');
  if(!document.getElementById('f-version').value) document.getElementById('f-version').value='V1 â€” Original';
  showToast('âœ“ Texto distribuÃ­do!');
}

// â”€â”€ DASHBOARD â”€â”€
function renderDashboard(){
  document.getElementById('stat-total').textContent=data.sermons.length;
  document.getElementById('stat-locations').textContent=[...new Set(data.sermons.map(s=>s.location).filter(Boolean))].length;
  document.getElementById('stat-studies').textContent=data.studies.length;
  const now=new Date();
  document.getElementById('stat-month').textContent=data.sermons.filter(s=>{if(!s.date)return false;const d=new Date(s.date);return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();}).length;
  const c=document.getElementById('dashboard-recent'); const r=data.sermons.slice(0,6);
  c.innerHTML=r.length?r.map(s=>sermonCard(s)).join(''):`<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">âœ</div><p>Nenhuma mensagem ainda.</p><p style="margin-top:10px"><button class="btn btn-primary" onclick="showPage('new-sermon')">Registrar Primeira Mensagem</button></p></div>`;
}

// â”€â”€ SERMON CARD â”€â”€
const catL={evangelismo:'Evangelismo',edificacao:'EdificaÃ§Ã£o',jovens:'Jovens',batismo:'Batismo',estudo:'Estudo'};
function sermonCard(s){
  const d=s.date?new Date(s.date+'T12:00').toLocaleDateString('pt-BR'):'';
  const vc=s.versions?s.versions.length:1;
  return `<div class="sermon-card" onclick="openSermon(${s.id})">
    <div class="sermon-card-tag tag-${s.category}">${catL[s.category]||s.category}</div>
    <h3>${s.title}</h3>
    <div class="meta">${d?`<span>ğŸ“… ${d}</span>`:''}${s.location?`<span>ğŸ“ ${s.location}</span>`:''}</div>
    ${s.verse?`<div class="verse">${s.verse}</div>`:''}
    ${s.theme?`<div class="excerpt">${s.theme}</div>`:''}
    <div class="sermon-card-footer">
      <span style="font-size:11px;color:var(--muted)">ğŸ“„ ${vc} versÃ£o(Ãµes)${s.duration?` Â· â± ${s.duration}`:''}</span>
      <span style="font-size:11px;color:var(--gold)">Ver â†’</span>
    </div>
  </div>`;
}

// â”€â”€ RENDER SERMONS â”€â”€
function renderSermons(){
  let list=data.sermons;
  if(currentFilter!=='all') list=list.filter(s=>s.category===currentFilter);
  if(currentSearch){const q=currentSearch.toLowerCase(); list=list.filter(s=>s.title.toLowerCase().includes(q)||(s.verse||'').toLowerCase().includes(q)||(s.location||'').toLowerCase().includes(q)||(s.theme||'').toLowerCase().includes(q)||(s.body||'').toLowerCase().includes(q));}
  const g=document.getElementById('sermons-grid');
  g.innerHTML=list.length?list.map(s=>sermonCard(s)).join(''):`<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">ğŸ”</div><p>Nenhuma mensagem encontrada.</p></div>`;
}
function filterSermons(v){currentSearch=v;renderSermons();}
function setFilter(v,el){currentFilter=v;document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderSermons();}

// â”€â”€ OPEN SERMON â”€â”€
function openSermon(id){
  const s=data.sermons.find(x=>x.id===id); if(!s)return;
  currentSermonId=id; currentVersionIdx=0;
  const d=s.date?new Date(s.date+'T12:00').toLocaleDateString('pt-BR',{weekday:'long',year:'numeric',month:'long',day:'numeric'}):'';
  document.getElementById('detail-header').innerHTML=`
    <div class="sermon-card-tag tag-${s.category}" style="margin-bottom:10px">${catL[s.category]||s.category}</div>
    <h2>${s.title}</h2>
    <div style="font-size:12px;color:var(--muted);display:flex;gap:14px;flex-wrap:wrap;margin:8px 0">
      ${d?`<span>ğŸ“… ${d}</span>`:''}${s.location?`<span>ğŸ“ ${s.location}</span>`:''}
      ${s.duration?`<span>â± ${s.duration}</span>`:''}
    </div>
    ${s.verse?`<div class="verse" style="margin:8px 0">${s.verse}</div>`:''}
    ${s.theme?`<div style="font-size:13px;color:var(--muted);margin-bottom:10px">${s.theme}</div>`:''}
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:12px">
      <button class="btn btn-edit btn-sm" onclick="editSermon(${s.id})">âœï¸ Editar</button>
      <button class="btn btn-tp btn-sm" onclick="openTeleprompter(${s.id})">ğŸ“º Teleprompter</button>
      <button class="btn btn-dup btn-sm" onclick="duplicateSermon(${s.id})">â§‰ Duplicar</button>
      <div class="export-menu">
        <button class="btn btn-ghost btn-sm" onclick="toggleExportMenu(${s.id},event)">â¬‡ Exportar â–¾</button>
        <div class="export-dropdown" id="export-menu-${s.id}">
          <div class="export-section-label">VersÃ£o selecionada</div>
          <div class="export-option" onclick="exportCurrentVersion('txt');closeAllMenus()">ğŸ“„ TXT</div>
          <div class="export-option" onclick="exportCurrentVersion('pdf');closeAllMenus()">ğŸ–¨ PDF</div>
          <div class="export-option" onclick="exportCurrentVersion('rtf');closeAllMenus()">ğŸ“ RTF (Pages/Word)</div>
          <div class="export-option" onclick="exportCurrentVersion('html');closeAllMenus()">ğŸŒ HTML formatado</div>
          <div class="export-section-label">Backup</div>
          <div class="export-option" onclick="backupSingleSermon(${s.id});closeAllMenus()">ğŸ’¾ Backup desta mensagem</div>
        </div>
      </div>
      <button class="btn btn-danger btn-sm" onclick="confirmDelete(${s.id})">ğŸ—‘ Excluir</button>
    </div>`;
  // Extra fields display
  const ef=document.getElementById('extra-fields-display');
  const hasExtra=s.objective||s.appeal||s.arc;
  if(hasExtra){
    ef.innerHTML=`<div class="extra-fields-grid">
      ${s.objective?`<div class="extra-field"><label>ğŸ¯ Objetivo</label><div class="val">${esc(s.objective)}</div></div>`:''}
      ${s.duration?`<div class="extra-field"><label>â± Tempo</label><div class="val">${esc(s.duration)}</div></div>`:''}
      ${s.appeal?`<div class="extra-field" style="grid-column:1/-1"><label>ğŸ“£ Apelo Final</label><div class="val">${esc(s.appeal).replace(/\n/g,'<br>')}</div></div>`:''}
      ${s.arc?`<div class="extra-field" style="grid-column:1/-1"><label>ğŸ“‘ Texto ARC/NAA</label><div class="val">${esc(s.arc).replace(/\n/g,'<br>')}</div></div>`:''}
    </div>`;
  } else ef.innerHTML='';
  // Versions
  renderVersionTabs(s);
  // Notes
  const ne=document.getElementById('detail-notes');
  if(s.notes){ne.style.display='block';ne.innerHTML=`<div class="section-title" style="margin-bottom:8px">ğŸ“ Notas Pessoais</div><p style="color:var(--muted);font-size:13px;line-height:1.8">${esc(s.notes).replace(/\n/g,'<br>')}</p>`;}
  else ne.style.display='none';
  document.getElementById('page-title').textContent=s.title;
  showPage('sermon-detail');
}

// â”€â”€ VERSION TABS â”€â”€
function renderVersionTabs(s){
  const vs=s.versions||[{name:'V1 â€” Original',date:new Date().toISOString(),body:s.body||''}];
  if(!s.versions) s.versions=vs;
  const colors=['v1','v2','v3','v4'];
  document.getElementById('version-tabs-row').innerHTML=vs.map((v,i)=>`
    <button class="version-tab ${i===currentVersionIdx?'active':''}" onclick="selectVersion(${s.id},${i})">
      <span class="version-label ${colors[i]||''}">V${i+1}</span>
      ${esc(v.name.replace(/^V\d+\s*[â€”\-â€“]?\s*/,''))||'Original'}
      ${v.aiGenerated?'<span style="font-size:9px;color:var(--ai2)">âœ¦AI</span>':''}
    </button>`).join('');
  renderVersionContent(s,currentVersionIdx);
}
function selectVersion(sid,idx){
  const s=data.sermons.find(x=>x.id===sid); if(!s)return;
  currentVersionIdx=idx;
  document.querySelectorAll('.version-tab').forEach((t,i)=>t.classList.toggle('active',i===idx));
  renderVersionContent(s,idx);
}
function renderVersionContent(s,idx){
  const v=s.versions[idx]; if(!v)return;
  const d=v.date?new Date(v.date).toLocaleDateString('pt-BR'):'';
  document.getElementById('version-body-display').textContent=v.body||'(Sem conteÃºdo)';
  document.getElementById('version-actions').innerHTML=`
    <div style="font-size:11px;color:var(--muted)">Salva em ${d}${v.aiGenerated?' Â· âœ¦ Gerada por IA':''}</div>
    <div style="display:flex;gap:5px;margin-left:auto;flex-wrap:wrap">
      <button class="btn btn-ghost btn-xs" onclick="exportVersionAs(${s.id},${idx},'txt')">ğŸ“„ TXT</button>
      <button class="btn btn-ghost btn-xs" onclick="exportVersionAs(${s.id},${idx},'pdf')">ğŸ–¨ PDF</button>
      <button class="btn btn-ghost btn-xs" onclick="exportVersionAs(${s.id},${idx},'rtf')">ğŸ“ RTF</button>
      <button class="btn btn-ghost btn-xs" onclick="exportVersionAs(${s.id},${idx},'html')">ğŸŒ HTML</button>
      <button class="btn btn-tp btn-xs" onclick="openTeleprompterVersion(${s.id},${idx})">ğŸ“º</button>
      ${idx>0?`<button class="btn btn-danger btn-xs" onclick="deleteVersion(${s.id},${idx})">ğŸ—‘</button>`:''}
    </div>`;
}
function deleteVersion(sid,idx){
  const s=data.sermons.find(x=>x.id===sid); if(!s||!s.versions[idx])return;
  if(idx===0){showToast('âš ï¸ NÃ£o Ã© possÃ­vel excluir a versÃ£o original.');return;}
  if(!confirm(`Excluir "${s.versions[idx].name}"?`))return;
  s.versions.splice(idx,1); save(); currentVersionIdx=0;
  showToast('âœ“ VersÃ£o excluÃ­da.'); renderVersionTabs(s);
}

// â”€â”€ ADD VERSION MANUAL â”€â”€
function addVersionManual(){
  const s=data.sermons.find(x=>x.id===currentSermonId); if(!s)return;
  const nv=(s.versions?s.versions.length:1)+1;
  document.getElementById('av-sermon-id').value=currentSermonId;
  document.getElementById('av-name').value=`V${nv} â€” `;
  document.getElementById('av-body').value=s.body||'';
  openModal('add-version-modal');
}
function saveNewVersion(){
  const sid=parseInt(document.getElementById('av-sermon-id').value);
  const s=data.sermons.find(x=>x.id===sid); if(!s)return;
  const name=document.getElementById('av-name').value.trim()||`V${(s.versions||[]).length+1}`;
  const body=document.getElementById('av-body').value.trim();
  s.versions=s.versions||[{name:'V1 â€” Original',date:new Date().toISOString(),body:s.body||''}];
  s.versions.push({name,date:new Date().toISOString(),body});
  save(); closeModal('add-version-modal'); showToast(`âœ“ ${name} salva!`);
  currentVersionIdx=s.versions.length-1; renderVersionTabs(s);
}

// â”€â”€ EDIT â”€â”€
function editSermon(id){
  const s=data.sermons.find(x=>x.id===id); if(!s)return;
  document.getElementById('edit-id').value=id;
  ['title','verse','location','theme','body','notes','duration','objective','appeal','arc'].forEach(f=>{
    const el=document.getElementById('edit-'+f); if(el) el.value=s[f]||'';
  });
  document.getElementById('edit-date').value=s.date||'';
  document.getElementById('edit-category').value=s.category||'evangelismo';
  openModal('edit-modal');
}
function saveEdit(){
  const id=parseInt(document.getElementById('edit-id').value);
  const s=data.sermons.find(x=>x.id===id); if(!s)return;
  const title=document.getElementById('edit-title').value.trim();
  if(!title){showToast('âš ï¸ Informe o tÃ­tulo.');return;}
  ['title','verse','location','theme','notes','duration','objective','appeal','arc'].forEach(f=>{
    const el=document.getElementById('edit-'+f); if(el) s[f]=el.value.trim();
  });
  const newBody=document.getElementById('edit-body').value.trim();
  s.date=document.getElementById('edit-date').value;
  s.category=document.getElementById('edit-category').value;
  s.body=newBody;
  if(s.versions&&s.versions[0]) s.versions[0].body=newBody;
  save(); closeModal('edit-modal'); showToast('âœ“ Mensagem atualizada!'); openSermon(id);
}

// â”€â”€ DUPLICATE â”€â”€
function duplicateSermon(id){
  const s=data.sermons.find(x=>x.id===id); if(!s)return;
  const copy=JSON.parse(JSON.stringify(s));
  copy.id=Date.now();
  copy.title=`${s.title} (cÃ³pia)`;
  copy.date='';
  copy.location='';
  if(copy.versions) copy.versions=copy.versions.map((v,i)=>({...v,date:new Date().toISOString()}));
  data.sermons.unshift(copy); save(); updateBadge();
  showToast('â§‰ Mensagem duplicada! Edite conforme necessÃ¡rio.');
  openSermon(copy.id);
}

// â”€â”€ BACKUP SINGLE â”€â”€
function backupSingleSermon(id){
  const s=data.sermons.find(x=>x.id===id); if(!s)return;
  const blob=new Blob([JSON.stringify({sermons:[s]},null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download=`backup_${slug(s.title)}_${new Date().toISOString().split('T')[0]}.json`; a.click();
  showToast('ğŸ’¾ Backup desta mensagem exportado!');
}

// â”€â”€ DELETE â”€â”€
function confirmDelete(id){
  _pendingDeleteId=id; document.getElementById('confirm-overlay').classList.add('open');
  document.getElementById('confirm-delete-btn').onclick=()=>{deleteSermon(_pendingDeleteId);closeConfirm();};
}
function closeConfirm(){ document.getElementById('confirm-overlay').classList.remove('open'); }
document.getElementById('confirm-overlay').addEventListener('click',e=>{if(e.target===document.getElementById('confirm-overlay'))closeConfirm();});
function deleteSermon(id){
  data.sermons=data.sermons.filter(s=>s.id!==id); save(); updateBadge();
  showToast('âœ“ Mensagem excluÃ­da.'); showPage('sermons');
}

// â”€â”€ EXPORT MENUS â”€â”€
function toggleExportMenu(id,e){ e.stopPropagation(); closeAllMenus(); const m=document.getElementById('export-menu-'+id); if(m)m.classList.toggle('open'); }
function closeAllMenus(){ document.querySelectorAll('.export-dropdown').forEach(m=>m.classList.remove('open')); }
document.addEventListener('click',closeAllMenus);

// â”€â”€ EXPORT LOGIC â”€â”€
const esc=v=>String(v||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
const slug=s=>(s||'x').replace(/[^a-z0-9]/gi,'_').toLowerCase().replace(/_+/g,'_').replace(/^_|_$/g,'');
const cLabel=c=>catL[c]||c||'-';

function exportCurrentVersion(fmt){ const s=data.sermons.find(x=>x.id===currentSermonId); if(!s)return; exportVersionAs(currentSermonId,currentVersionIdx,fmt); }
function exportVersionAs(sid,vi,fmt){
  const s=data.sermons.find(x=>x.id===sid); if(!s)return;
  const v=s.versions?s.versions[vi]:null;
  const body=v?v.body:(s.body||'');
  const vName=v?v.name:'V1';
  const ed={...s,body,_versionName:vName};
  if(fmt==='txt') doExportTXT(ed);
  else if(fmt==='pdf') doExportPDF(ed);
  else if(fmt==='rtf') doExportRTF(ed);
  else if(fmt==='html') doExportHTML(ed);
}

function doExportTXT(s){
  const d=s.date?new Date(s.date+'T12:00').toLocaleDateString('pt-BR'):'-';
  const lines=[s.title,'',`VersÃ£o: ${s._versionName}`,`Categoria: ${cLabel(s.category)}`,`Texto BÃ­blico: ${s.verse||'-'}`,`Data: ${d}`,`Local: ${s.location||'-'}`];
  if(s.duration) lines.push(`Tempo Estimado: ${s.duration}`);
  if(s.objective) lines.push(`Objetivo: ${s.objective}`);
  lines.push('','Tema:',s.theme||'-','','â”€'.repeat(32),'',s.body||'','','â”€'.repeat(32));
  if(s.appeal) lines.push('','Apelo Final:',s.appeal);
  if(s.arc) lines.push('','Texto ARC/NAA:',s.arc);
  lines.push('','Notas:',s.notes||'-','','MinistÃ©rio â€” Edson Luiz');
  const blob=new Blob([lines.join('\n')],{type:'text/plain;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${slug(s.title)}_${slug(s._versionName)}.txt`; a.click();
  showToast('âœ“ TXT exportado!');
}

function doExportPDF(s){
  const d=s.date?new Date(s.date+'T12:00').toLocaleDateString('pt-BR'):'-';
  const bh=esc(s.body||'').replace(/\n/g,'<br>'), nh=esc(s.notes||'').replace(/\n/g,'<br>'), ah=esc(s.appeal||'').replace(/\n/g,'<br>');
  const html=`<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"><title>${esc(s.title)}</title>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@600&display=swap" rel="stylesheet">
<style>*{box-sizing:border-box;margin:0;padding:0}body{font-family:'EB Garamond',Georgia,serif;font-size:12.5pt;line-height:1.85;color:#1a1a1a}.page{max-width:680px;margin:0 auto;padding:44px 38px 56px}.hbar{border-top:4px solid #8b6914;border-bottom:1px solid #ddd;padding:20px 0 16px;margin-bottom:24px;text-align:center}.cat{display:inline-block;font-size:8pt;letter-spacing:.15em;text-transform:uppercase;background:#f5ead5;color:#8b6914;border:1px solid #c9a84c;padding:2px 10px;border-radius:20px;margin-bottom:7px}.vbadge{font-size:9pt;color:#8b6914;background:#f5ead5;border:1px solid #ddd;padding:2px 8px;border-radius:4px;margin-top:5px;display:inline-block}h1{font-family:'Cinzel','Times New Roman',serif;font-size:21pt;color:#4a2e00;line-height:1.25;margin-bottom:7px}.ml{font-size:10pt;color:#888}.verse{font-style:italic;font-size:12pt;color:#6b4f0e;border-left:3px solid #c9a84c;padding:8px 15px;margin:18px 0;background:#fdfaf2;border-radius:0 6px 6px 0}.tb{font-size:12pt;color:#444;border:1px solid #e8dfc5;padding:10px 14px;border-radius:6px;margin-bottom:20px;background:#fefdf8}.body{font-size:12pt;line-height:2}hr{border:none;border-top:1px solid #e0d5c0;margin:24px 0}.nb{background:#f8f5ee;border:1px solid #e0d5c0;border-radius:8px;padding:14px 17px;margin-top:20px}.nl{font-family:'Cinzel',serif;font-size:10pt;color:#8b6914;margin-bottom:5px}.nt{font-size:11pt;color:#666;line-height:1.7}.ab{border:1px solid #d9e8d5;background:#f5faf5;border-radius:8px;padding:14px 17px;margin-top:14px}.al{font-family:'Cinzel',serif;font-size:10pt;color:#4a7c4a;margin-bottom:5px}footer{text-align:center;margin-top:34px;padding-top:14px;border-top:1px solid #eee;font-size:9pt;color:#bbb;letter-spacing:.12em;text-transform:uppercase}@media print{.page{padding:14px 24px 32px}@page{margin:1.5cm 1.8cm}}</style>
</head><body><div class="page">
<div class="hbar"><div class="cat">${esc(cLabel(s.category))}</div>
<h1>${esc(s.title)}</h1>
<div class="ml">ğŸ“… ${esc(d)}${s.location?' &nbsp;Â·&nbsp; ğŸ“ '+esc(s.location):''}${s.duration?' &nbsp;Â·&nbsp; â± '+esc(s.duration):''}</div>
<div class="vbadge">${esc(s._versionName)}</div></div>
${s.verse?`<div class="verse">${esc(s.verse)}</div>`:''}
${s.theme?`<div class="tb"><strong>Tema:</strong> ${esc(s.theme)}</div>`:''}
${s.objective?`<div class="tb" style="border-color:#d0e0d0;background:#f5faf5"><strong>ğŸ¯ Objetivo:</strong> ${esc(s.objective)}</div>`:''}
<div class="body">${bh||'<em style="color:#999">Sem conteÃºdo.</em>'}</div>
${s.appeal?`<hr><div class="ab"><div class="al">ğŸ“£ Apelo Final</div><div class="nt">${ah}</div></div>`:''}
${s.notes?`<hr><div class="nb"><div class="nl">ğŸ“ Notas Pessoais</div><div class="nt">${nh}</div></div>`:''}
<footer>MinistÃ©rio â€” Edson Luiz</footer></div></body></html>`;
  const iframe=document.createElement('iframe'); iframe.style.cssText='position:fixed;right:0;bottom:0;width:0;height:0;border:0;'; document.body.appendChild(iframe);
  const doc=iframe.contentWindow.document; doc.open(); doc.write(html); doc.close();
  setTimeout(()=>{try{iframe.contentWindow.focus();iframe.contentWindow.print();showToast('âœ“ Salve como PDF na caixa de impressÃ£o');}catch(e){showToast('âš ï¸ Tente no Chrome/Edge.');}setTimeout(()=>iframe.remove(),2000);},700);
}

function doExportRTF(s){
  const d=s.date?new Date(s.date+'T12:00').toLocaleDateString('pt-BR'):'-';
  function r(str){return(str||'').replace(/\\/g,'\\\\').replace(/\{/g,'\\{').replace(/\}/g,'\\}').replace(/[^\x00-\x7F]/g,c=>{const code=c.charCodeAt(0);return code>255?`\\u${code}?`:`\\'${code.toString(16).padStart(2,'0')}`;});}
  const bl=(s.body||'').split('\n').map(l=>r(l)+'\\par').join('\n');
  const nl=(s.notes||'').split('\n').map(l=>r(l)+'\\par').join('\n');
  const al=(s.appeal||'').split('\n').map(l=>r(l)+'\\par').join('\n');
  const rtf=`{\\rtf1\\ansi\\deff0\n{\\fonttbl{\\f0\\froman\\fcharset0 Times New Roman;}{\\f1\\fswiss\\fcharset0 Arial;}}\n{\\colortbl;\\red0\\green0\\blue0;\\red100\\green70\\blue10;\\red100\\green100\\blue100;}\n\\paperw12240\\paperh15840\\margl1800\\margr1800\\margt1440\\margb1440\n{\\pard\\qc\\cf2\\b\\fs40 ${r(s.title)}\\b0\\par}\n\\pard\\qc\\cf3\\fs20 ${r(cLabel(s.category))} â€” ${r(d)} â€” ${r(s._versionName)}\\par\n${s.location?`\\pard\\qc\\cf3\\fs20 ${r(s.location)}\\par`:''}\n${s.duration?`\\pard\\qc\\cf3\\fs18 â± ${r(s.duration)}\\par`:''}\n\\pard\\par\n${s.verse?`{\\pard\\qc\\cf2\\i\\fs24 "${r(s.verse)}"\\i0\\par}\\pard\\par`:''}\n${s.theme?`{\\pard\\b\\fs22 Tema: \\b0 ${r(s.theme)}\\par}\\pard\\par`:''}\n${s.objective?`{\\pard\\b\\fs22 Objetivo: \\b0 ${r(s.objective)}\\par}\\pard\\par`:''}\n{\\pard\\brdrb\\brdrs\\brdrw10 \\par}\\pard\\par\n\\pard\\fs24\n${bl}\n\\pard\\par\n${s.appeal?`{\\pard\\brdrt\\brdrs\\brdrw10 \\par}\\pard\\par{\\pard\\b Apelo Final:\\b0\\par}\\pard\\fs22\n${al}\\pard\\par`:''}\n${s.notes?`{\\pard\\brdrt\\brdrs\\brdrw10 \\par}\\pard\\par{\\pard\\b Notas:\\b0\\par}\\pard\\cf3\\fs22\n${nl}\\pard\\par`:''}\n\\pard\\qr\\cf3\\fs18 MinistÃ©rio â€” Edson Luiz\\par\n}`;
  const blob=new Blob([rtf],{type:'application/rtf'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${slug(s.title)}_${slug(s._versionName)}.rtf`; a.click();
  showToast('âœ“ RTF exportado â€” abra no Pages ou Word!');
}

function doExportHTML(s){
  const d=s.date?new Date(s.date+'T12:00').toLocaleDateString('pt-BR'):'-';
  const bh=esc(s.body||'').replace(/\n/g,'<br>'), nh=esc(s.notes||'').replace(/\n/g,'<br>'), ah=esc(s.appeal||'').replace(/\n/g,'<br>');
  const html=`<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"><title>${esc(s.title)}</title><link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@600&display=swap" rel="stylesheet"><style>body{font-family:'EB Garamond',serif;font-size:13pt;line-height:1.9;color:#1a1a1a;margin:0;background:#fff}.page{max-width:700px;margin:60px auto;padding:0 40px 60px}header{text-align:center;border-bottom:2px solid #8b6914;padding-bottom:24px;margin-bottom:28px}h1{font-family:'Cinzel',serif;font-size:24pt;color:#5a3e00;margin:0 0 8px;line-height:1.2}.meta-row{font-size:10pt;color:#888;letter-spacing:.08em;text-transform:uppercase;margin:3px 0}.vbadge{display:inline-block;font-size:9pt;background:#f5ead5;color:#8b6914;border:1px solid #c9a84c;padding:2px 8px;border-radius:4px;margin-top:5px}.verse-block{font-style:italic;font-size:13pt;color:#7a5c1a;border-left:3px solid #c9a84c;padding:10px 16px;margin:20px 0;background:#fdfaf3}.theme-block{font-size:12pt;color:#444;border:1px solid #e5d9bc;padding:11px 15px;border-radius:6px;margin-bottom:20px;background:#fefcf5}.body-section{font-size:12.5pt;line-height:2}.divider{border:none;border-top:1px solid #ddd;margin:26px 0}.notes-section{background:#f9f7f2;border:1px solid #e5d9bc;border-radius:6px;padding:14px 18px;font-size:11pt;color:#666}.notes-section h4{font-family:'Cinzel',serif;font-size:11pt;color:#8b6914;margin:0 0 6px}.appeal-section{background:#f5faf5;border:1px solid #d9e8d5;border-radius:6px;padding:14px 18px;font-size:11pt;color:#444;margin-top:14px}.appeal-section h4{font-family:'Cinzel',serif;font-size:11pt;color:#4a7c4a;margin:0 0 6px}footer{text-align:center;margin-top:36px;font-size:10pt;color:#bbb;letter-spacing:.1em;text-transform:uppercase}</style></head><body><div class="page"><header>
<h1>${esc(s.title)}</h1><div class="meta-row">${esc(cLabel(s.category))}</div>
<div class="meta-row">ğŸ“… ${esc(d)}${s.location?' &nbsp;Â·&nbsp; ğŸ“ '+esc(s.location):''}${s.duration?' &nbsp;Â·&nbsp; â± '+esc(s.duration):''}</div>
<div class="vbadge">${esc(s._versionName)}</div></header>
${s.verse?`<div class="verse-block">${esc(s.verse)}</div>`:''}
${s.theme?`<div class="theme-block"><strong>Tema:</strong> ${esc(s.theme)}</div>`:''}
<div class="body-section">${bh||'<em>Sem conteÃºdo.</em>'}</div>
${s.appeal?`<hr class="divider"><div class="appeal-section"><h4>ğŸ“£ Apelo Final</h4>${ah}</div>`:''}
${s.notes?`<hr class="divider"><div class="notes-section"><h4>ğŸ“ Notas Pessoais</h4>${nh}</div>`:''}
<footer>MinistÃ©rio â€” Edson Luiz</footer></div></body></html>`;
  const blob=new Blob([html],{type:'text/html;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${slug(s.title)}_${slug(s._versionName)}.html`; a.click();
  showToast('âœ“ HTML exportado!');
}

// â”€â”€ LOCATIONS / STUDIES / PHOTOS â”€â”€
function renderLocations(){
  const c=document.getElementById('locations-list'); const lm={};
  data.sermons.forEach(s=>{if(s.location)lm[s.location]=(lm[s.location]||0)+1;});
  const ls=Object.entries(lm).sort((a,b)=>b[1]-a[1]);
  c.innerHTML=ls.length?ls.map(([l,n])=>`<div class="location-item"><div class="location-icon">ğŸ›ï¸</div><div class="location-info"><h4>${esc(l)}</h4><p>${n} pregaÃ§Ã£o(Ãµes)</p></div><div class="location-count">${n}x</div></div>`).join(''):`<div class="empty-state"><div class="empty-icon">ğŸ“</div><p>Nenhum local registrado.</p></div>`;
}
function renderStudies(){
  const g=document.getElementById('studies-grid');
  g.innerHTML=data.studies.length?data.studies.map(s=>`<div class="study-card"><h4>${esc(s.title)}</h4><p>${esc(s.passage||'')}</p><p style="margin-top:5px;color:var(--muted)">${esc((s.content||'').substring(0,110))}...</p><div class="tags">${(s.tags||'').split(',').filter(Boolean).map(t=>`<span class="sermon-card-tag tag-estudo">${esc(t.trim())}</span>`).join('')}</div></div>`).join(''):`<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">ğŸ“š</div><p>Nenhum estudo ainda.</p></div>`;
}
function saveStudy(){
  const t=document.getElementById('sf-title').value.trim();
  if(!t){showToast('âš ï¸ Informe o tÃ­tulo.');return;}
  data.studies.push({id:Date.now(),title:t,passage:document.getElementById('sf-passage').value.trim(),content:document.getElementById('sf-content').value.trim(),tags:document.getElementById('sf-tags').value.trim(),date:new Date().toISOString()});
  save(); closeModal('study-modal'); showToast('âœ“ Estudo salvo!'); renderStudies();
  ['sf-title','sf-passage','sf-content','sf-tags'].forEach(id=>document.getElementById(id).value='');
}
function handlePhotos(input){
  Array.from(input.files).forEach(f=>{const r=new FileReader();r.onload=e=>{data.photos.push({id:Date.now()+Math.random(),src:e.target.result,name:f.name,date:new Date().toISOString()});save();renderPhotos();showToast('ğŸ“· Foto adicionada!');};r.readAsDataURL(f);});
}
function renderPhotos(){ document.getElementById('photo-grid').innerHTML=data.photos.map(p=>`<div class="photo-item"><img src="${p.src}" alt="${esc(p.name)}"></div>`).join(''); }

// â”€â”€ BACKUP / IMPORT â”€â”€
function exportAllData(){
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download=`ministerio-edson-backup-${new Date().toISOString().split('T')[0]}.json`; a.click();
  showToast('ğŸ’¾ Backup geral exportado!');
}
function importData(input){
  const file=input.files[0]; if(!file)return;
  const r=new FileReader();
  r.onload=e=>{
    try{
      const imp=JSON.parse(e.target.result);
      if(!imp.sermons){showToast('âš ï¸ Arquivo invÃ¡lido.');return;}
      if(!confirm(`Importar ${imp.sermons.length} mensagem(ns)?`))return;
      const ex=new Set(data.sermons.map(s=>s.id)); let added=0;
      imp.sermons.forEach(s=>{if(!ex.has(s.id)){data.sermons.push(s);added++;}});
      if(imp.studies){const es=new Set(data.studies.map(s=>s.id));imp.studies.forEach(s=>{if(!es.has(s.id))data.studies.push(s);});}
      save(); updateBadge(); renderDashboard(); showToast(`âœ“ ${added} mensagem(ns) importada(s)!`);
    }catch{showToast('âš ï¸ Erro ao ler o arquivo.');}
    input.value='';
  };
  r.readAsText(file);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TELEPROMPTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tpPlaying=false, tpSpeed=1.0, tpFontSize=52, tpMirrored=false;
let tpInterval=null, tpScrollEl=null, tpTextEl=null;

function getSermonTextForTP(s, vIdx){
  const v=s.versions&&s.versions[vIdx]?s.versions[vIdx]:null;
  const body=v?v.body:(s.body||'');
  let parts=[];
  if(s.verse) parts.push(`âœ ${s.verse}\n`);
  if(s.theme) parts.push(`${s.theme}\n\n`);
  parts.push(body);
  if(s.appeal) parts.push(`\n\nğŸ“£ APELO\n\n${s.appeal}`);
  return parts.join('');
}

function openTeleprompter(id){ openTeleprompterVersion(id,currentVersionIdx||0); }
function openTeleprompterVersion(id,vIdx){
  const s=data.sermons.find(x=>x.id===id); if(!s)return;
  const text=getSermonTextForTP(s,vIdx);
  tpScrollEl=document.getElementById('tp-scroll');
  tpTextEl=document.getElementById('tp-text');
  document.getElementById('tp-title').textContent=`${s.title}${s.versions&&s.versions[vIdx]?' â€” '+s.versions[vIdx].name:''}`;
  // Build HTML paragraphs
  tpTextEl.innerHTML=text.split(/\n+/).filter(l=>l.trim()).map(l=>`<p>${esc(l)}</p>`).join('');
  tpFontSize=52; tpSpeed=1.0; tpPlaying=false; tpMirrored=false;
  tpTextEl.style.fontSize=tpFontSize+'px';
  tpTextEl.classList.remove('mirrored');
  document.getElementById('tp-play-btn').textContent='â–¶ Iniciar';
  document.getElementById('tp-play-btn').classList.remove('active');
  document.getElementById('tp-mirror-btn').classList.remove('active');
  document.getElementById('tp-speed-display').textContent=`Vel: ${tpSpeed.toFixed(1)}`;
  document.getElementById('tp-progress').style.width='0%';
  tpScrollEl.scrollTop=0;
  document.getElementById('tp-overlay').classList.add('open');
  // Hint
  const hint=document.createElement('div'); hint.className='tp-overlay-hint'; hint.textContent='EspaÃ§o = Pausar/Iniciar Â· â†‘â†“ = Velocidade Â· +/- = Tamanho';
  document.getElementById('tp-overlay').appendChild(hint); setTimeout(()=>hint.remove(),4500);
  tpUpdateProgress();
}

function tpTogglePlay(){
  tpPlaying=!tpPlaying;
  const btn=document.getElementById('tp-play-btn');
  if(tpPlaying){
    btn.textContent='â¸ Pausar'; btn.classList.add('active');
    tpStartScroll();
  } else {
    btn.textContent='â–¶ Iniciar'; btn.classList.remove('active');
    clearInterval(tpInterval);
  }
}
function tpStartScroll(){
  clearInterval(tpInterval);
  tpInterval=setInterval(()=>{
    if(!tpPlaying){ clearInterval(tpInterval); return; }
    tpScrollEl.scrollTop+=tpSpeed;
    tpUpdateProgress();
    if(tpScrollEl.scrollTop+tpScrollEl.clientHeight>=tpScrollEl.scrollHeight-10){
      tpPlaying=false; clearInterval(tpInterval);
      document.getElementById('tp-play-btn').textContent='â–¶ Iniciar';
      document.getElementById('tp-play-btn').classList.remove('active');
    }
  },30);
}
function tpUpdateProgress(){
  const max=tpScrollEl.scrollHeight-tpScrollEl.clientHeight;
  const pct=max>0?(tpScrollEl.scrollTop/max*100):0;
  document.getElementById('tp-progress').style.width=pct+'%';
}
function tpFaster(){ tpSpeed=Math.min(tpSpeed+0.2,8); document.getElementById('tp-speed-display').textContent=`Vel: ${tpSpeed.toFixed(1)}`; if(tpPlaying){clearInterval(tpInterval);tpStartScroll();} }
function tpSlower(){ tpSpeed=Math.max(tpSpeed-0.2,0.2); document.getElementById('tp-speed-display').textContent=`Vel: ${tpSpeed.toFixed(1)}`; if(tpPlaying){clearInterval(tpInterval);tpStartScroll();} }
function tpFontUp(){ tpFontSize=Math.min(tpFontSize+8,120); tpTextEl.style.fontSize=tpFontSize+'px'; }
function tpFontDown(){ tpFontSize=Math.max(tpFontSize-8,24); tpTextEl.style.fontSize=tpFontSize+'px'; }
function tpToggleMirror(){ tpMirrored=!tpMirrored; tpTextEl.classList.toggle('mirrored',tpMirrored); document.getElementById('tp-mirror-btn').classList.toggle('active',tpMirrored); }
function tpRestart(){ tpScrollEl.scrollTop=0; tpUpdateProgress(); }
function closeTeleprompter(){ clearInterval(tpInterval); tpPlaying=false; document.getElementById('tp-overlay').classList.remove('open'); }

// Keyboard shortcuts for teleprompter
document.addEventListener('keydown',e=>{
  if(!document.getElementById('tp-overlay').classList.contains('open'))return;
  if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName))return;
  if(e.key===' '||e.key==='k'){ e.preventDefault(); tpTogglePlay(); }
  else if(e.key==='ArrowUp'||e.key==='+'||e.key==='='){ tpFaster(); }
  else if(e.key==='ArrowDown'||e.key==='-'){ tpSlower(); }
  else if(e.key==='r'||e.key==='R'){ tpRestart(); }
  else if(e.key==='m'||e.key==='M'){ tpToggleMirror(); }
  else if(e.key==='Escape'){ closeTeleprompter(); }
  else if(e.key==='>'){ tpFontUp(); }
  else if(e.key==='<'){ tpFontDown(); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AI â€” PROVIDER SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getActiveProvider(){ return localStorage.getItem('active_ai_provider')||'oai'; }
function setActiveProvider(p){
  localStorage.setItem('active_ai_provider',p);
  updateAiStatus(); updateActiveProviderUI();
  showToast(p==='oai'?'ğŸ’š ChatGPT ativado como IA principal':'ğŸ”µ Claude ativado como IA principal');
}
function getOAIKey(){ return localStorage.getItem('openai_api_key')||''; }
function getClaudeKey(){ return localStorage.getItem('claude_api_key')||''; }

function saveOAIKey(){ const k=document.getElementById('oai-key-input').value.trim(); if(!k){showToast('âš ï¸ Chave vazia.');return;} localStorage.setItem('openai_api_key',k); updateAiStatus(); showToast('âœ“ Chave OpenAI salva!'); }
function saveClaudeKey(){ const k=document.getElementById('claude-key-input').value.trim(); if(!k){showToast('âš ï¸ Chave vazia.');return;} localStorage.setItem('claude_api_key',k); updateAiStatus(); showToast('âœ“ Chave Claude salva!'); }
function clearOAIKey(){ localStorage.removeItem('openai_api_key'); document.getElementById('oai-key-input').value=''; updateAiStatus(); showToast('Chave OpenAI removida.'); }
function clearClaudeKey(){ localStorage.removeItem('claude_api_key'); document.getElementById('claude-key-input').value=''; updateAiStatus(); showToast('Chave Claude removida.'); }

function updateAiStatus(){
  const dot=document.getElementById('ai-dot'), txt=document.getElementById('ai-status-text');
  const p=getActiveProvider(), oaiOk=!!getOAIKey(), clOk=!!getClaudeKey();
  if(p==='oai'&&oaiOk){ dot.classList.add('connected','oai'); dot.classList.remove; txt.textContent='ChatGPT â€” ativo'; }
  else if(p==='claude'&&clOk){ dot.classList.add('connected'); dot.classList.remove('oai'); txt.textContent='Claude â€” ativo'; }
  else if(oaiOk||clOk){ dot.classList.add('connected'); txt.textContent='IA configurada'; }
  else { dot.classList.remove('connected','oai'); txt.textContent='IA â€” configurar'; }
  updateActiveProviderUI();
}

function updateActiveProviderUI(){
  const p=getActiveProvider();
  const ob=document.getElementById('active-oai-btn'), cb=document.getElementById('active-claude-btn');
  if(!ob||!cb)return;
  ob.className='btn btn-sm '+(p==='oai'?'btn-primary':'btn-ghost'); ob.style.background=p==='oai'?'var(--oai)':'';
  cb.className='btn btn-sm '+(p==='claude'?'btn-ai':'btn-ghost');
  document.getElementById('active-provider-display').textContent=`IA ativa: ${p==='oai'?'ğŸ’š ChatGPT ('+document.getElementById('oai-model-select')?.value+')':'ğŸ”µ Claude ('+document.getElementById('claude-model-select')?.value+')'}`;
}

function switchProviderTab(p){
  ['oai','claude'].forEach(x=>{
    document.getElementById('tab-'+x).className='provider-tab'+(x===p?' active-'+x:'');
    document.getElementById('panel-'+x).className='provider-panel'+(x===p?' active':'');
  });
  if(p==='oai') document.getElementById('oai-key-input').value=getOAIKey();
  else document.getElementById('claude-key-input').value=getClaudeKey();
}

async function testOAIKey(){
  const k=document.getElementById('oai-key-input').value.trim()||getOAIKey();
  const el=document.getElementById('oai-key-status');
  if(!k){el.textContent='âš ï¸ Chave vazia.';return;}
  el.style.color='var(--muted)'; el.textContent='ğŸ” Testando...';
  try{ const t=await callOpenAI([{role:'user',content:'Responda sÃ³ "OK".'}],10,k,'gpt-4o-mini'); el.style.color='var(--green)'; el.textContent='âœ“ Funcionando! '+t.substring(0,20); }
  catch(e){ el.style.color='var(--red)'; el.textContent='âœ— '+e.message; }
}
async function testClaudeKey(){
  const k=document.getElementById('claude-key-input').value.trim()||getClaudeKey();
  const el=document.getElementById('claude-key-status');
  if(!k){el.textContent='âš ï¸ Chave vazia.';return;}
  el.style.color='var(--muted)'; el.textContent='ğŸ” Testando...';
  try{ const t=await callClaude([{role:'user',content:'Responda sÃ³ "OK".'}],10,k,'claude-haiku-4-5-20251001'); el.style.color='var(--green)'; el.textContent='âœ“ Funcionando! '+t.substring(0,20); }
  catch(e){ el.style.color='var(--red)'; el.textContent='âœ— '+e.message; }
}

// â”€â”€ UNIFIED AI CALL â”€â”€
async function callAI(messages,maxTokens=1500){
  const p=getActiveProvider();
  if(p==='oai'){
    const k=getOAIKey(); if(!k)throw new Error('Chave OpenAI nÃ£o configurada. Configure na barra lateral.');
    const m=document.getElementById('oai-model-select')?.value||'gpt-4o-mini';
    return callOpenAI(messages,maxTokens,k,m);
  } else {
    const k=getClaudeKey(); if(!k)throw new Error('Chave Claude nÃ£o configurada. Configure na barra lateral.');
    const m=document.getElementById('claude-model-select')?.value||'claude-haiku-4-5-20251001';
    return callClaude(messages,maxTokens,k,m);
  }
}

async function callOpenAI(messages,maxTokens,key,model){
  const res=await fetch('https://api.openai.com/v1/chat/completions',{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+key},
    body:JSON.stringify({model,max_tokens:maxTokens,messages:[{role:'system',content:'VocÃª Ã© um assistente ministerial especializado em sermÃµes evangÃ©licos em portuguÃªs do Brasil. Seja prÃ¡tico, bÃ­blico e pastoralmente sensÃ­vel.'},...messages]})
  });
  if(!res.ok){const e=await res.json().catch(()=>({})); throw new Error(e.error?.message||`OpenAI HTTP ${res.status}`);}
  const d=await res.json(); return d.choices[0]?.message?.content||'';
}

async function callClaude(messages,maxTokens,key,model){
  const res=await fetch('https://api.anthropic.com/v1/messages',{
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
    body:JSON.stringify({model,max_tokens:maxTokens,messages})
  });
  if(!res.ok){const e=await res.json().catch(()=>({})); throw new Error(e.error?.message||`Claude HTTP ${res.status}`);}
  const d=await res.json(); return d.content[0]?.text||'';
}

// â”€â”€ AI VERSION GENERATION â”€â”€
function openAiVersionModal(){
  const s=data.sermons.find(x=>x.id===currentSermonId); if(!s)return;
  const nv=(s.versions?s.versions.length:1)+1;
  document.getElementById('aiv-sermon-id').value=currentSermonId;
  document.getElementById('aiv-name').value=`V${nv} â€” `;
  document.getElementById('aiv-instruction').value='';
  document.getElementById('aiv-preset').value='';
  document.getElementById('aiv-result').classList.remove('show');
  document.getElementById('aiv-save-row').style.display='none';
  document.getElementById('aiv-thinking').classList.remove('show');
  openModal('ai-version-modal');
}
function applyAiPreset(val){
  const p={simplify:'Reescreva com linguagem simples e acessÃ­vel para jovens/adolescentes. Use exemplos do cotidiano.',expand:'Expanda com mais teologia, versÃ­culos de apoio, ilustraÃ§Ãµes e exemplos prÃ¡ticos.',shorten:'Resuma para 15 minutos mantendo os 3 pontos principais, versÃ­culo e apelo.',evangelical:'Adapte para culto evangelÃ­stico com convite claro de salvaÃ§Ã£o.',devotional:'Transforme em devocional com reflexÃµes, perguntas e oraÃ§Ã£o final.',outline:'Extraia esboÃ§o: tÃ­tulo, versÃ­culo, pontos com subpontos, ilustraÃ§Ãµes e conclusÃ£o.'};
  if(val&&p[val]) document.getElementById('aiv-instruction').value=p[val];
}
async function generateAiVersion(){
  const sid=parseInt(document.getElementById('aiv-sermon-id').value);
  const s=data.sermons.find(x=>x.id===sid); if(!s)return;
  const inst=document.getElementById('aiv-instruction').value.trim();
  if(!inst){showToast('âš ï¸ Informe a instruÃ§Ã£o.');return;}
  const th=document.getElementById('aiv-thinking'), re=document.getElementById('aiv-result'), sr=document.getElementById('aiv-save-row'), btn=document.getElementById('aiv-btn');
  const prov=getActiveProvider();
  document.getElementById('aiv-thinking-text').textContent=`${prov==='oai'?'ChatGPT':'Claude'} estÃ¡ gerando...`;
  th.classList.add('show'); re.classList.remove('show'); sr.style.display='none'; btn.disabled=true;
  try{
    const prompt=`MENSAGEM ORIGINAL:\nTÃ­tulo: ${s.title}\nVersÃ­culo: ${s.verse||''}\nTema: ${s.theme||''}\nConteÃºdo:\n${s.body||''}\n\nINSTRUÃ‡ÃƒO:\n${inst}\n\nRETORNE APENAS o conteÃºdo adaptado, sem comentÃ¡rios. PortuguÃªs do Brasil. Mantenha fidelidade bÃ­blica.`;
    const t=await callAI([{role:'user',content:prompt}],2000);
    re.textContent=t; re.classList.add('show'); sr.style.display='flex';
    showToast('âœ“ VersÃ£o gerada!');
  }catch(e){re.textContent='âœ— '+e.message; re.classList.add('show'); if(e.message.includes('configurada'))openModal('api-key-modal');}
  finally{th.classList.remove('show'); btn.disabled=false;}
}
function saveAiVersion(){
  const sid=parseInt(document.getElementById('aiv-sermon-id').value);
  const s=data.sermons.find(x=>x.id===sid); if(!s)return;
  const name=document.getElementById('aiv-name').value.trim()||`V${(s.versions||[]).length+1} â€” IA`;
  const body=document.getElementById('aiv-result').textContent;
  s.versions=s.versions||[{name:'V1 â€” Original',date:new Date().toISOString(),body:s.body||''}];
  s.versions.push({name,date:new Date().toISOString(),body,aiGenerated:true,provider:getActiveProvider()});
  save(); closeModal('ai-version-modal'); showToast(`âœ“ ${name} salva!`);
  currentVersionIdx=s.versions.length-1; renderVersionTabs(s);
}

// â”€â”€ AI STUDIO TOOLS â”€â”€
const aiCfgs={
  'sermon-outline':{title:'ğŸ“ Gerar EsboÃ§o',label:'Tema ou passagem bÃ­blica',ph:'Ex: FÃ© que move montanhas â€” Mateus 17:20',prompt:i=>`Crie um esboÃ§o completo de sermÃ£o sobre: "${i}". Inclua: tÃ­tulo criativo, versÃ­culo base, introduÃ§Ã£o cativante, 3 pontos com subpontos e versÃ­culos de apoio, ilustraÃ§Ãµes sugeridas, apelo e oraÃ§Ã£o final. PortuguÃªs do Brasil.`},
  introduction:{title:'ğŸ¯ IntroduÃ§Ã£o Impactante',label:'Tema e versÃ­culo base',ph:'Ex: A paz de Filipenses 4:7',prompt:i=>`Crie 3 opÃ§Ãµes de introduÃ§Ã£o para sermÃ£o sobre "${i}": uma com histÃ³ria, uma com pergunta, uma com dado surpreendente. PortuguÃªs do Brasil, tom pastoral.`},
  illustration:{title:'ğŸ’¡ IlustraÃ§Ãµes',label:'Ponto que precisa de ilustraÃ§Ã£o',ph:'Ex: PerseveranÃ§a na fÃ©',prompt:i=>`Sugira 5 ilustraÃ§Ãµes para o tema "${i}". Cada uma com: histÃ³ria completa, conexÃ£o espiritual e versÃ­culo. PortuguÃªs do Brasil.`},
  verses:{title:'ğŸ“– VersÃ­culos Relacionados',label:'Tema ou passagem principal',ph:'Ex: PerdÃ£o, graÃ§a, Salmo 23',prompt:i=>`Liste 10 versÃ­culos relacionados a "${i}". Para cada: referÃªncia, texto NVI e conexÃ£o com o tema. Organize por subtemas.`},
  appeal:{title:'ğŸ“£ Apelo Final',label:'Tema da mensagem',ph:'Ex: Aceitar Jesus como Salvador',prompt:i=>`Escreva apelo final para sermÃ£o sobre "${i}". 2-3 parÃ¡grafos de convite, versÃ­culo e oraÃ§Ã£o de encerramento. Tom pastoral, genuÃ­no. PortuguÃªs do Brasil.`},
  improve:{title:'âœ¨ Melhorar Texto',label:'Cole o trecho a melhorar',ph:'Cole aqui...',prompt:i=>`Melhore este trecho de sermÃ£o tornando-o mais fluido, impactante e claro, sem perder o conteÃºdo:\n\n${i}\n\nRetorne apenas o texto melhorado.`}
};
let _curTool='';
function aiTool(k){
  _curTool=k; const c=aiCfgs[k]; if(!c)return;
  document.getElementById('ai-tool-modal-title').textContent=c.title;
  document.getElementById('ai-tool-modal-label').textContent=c.label;
  document.getElementById('ai-tool-modal-input').placeholder=c.ph;
  document.getElementById('ai-tool-modal-input').value='';
  document.getElementById('ai-tool-result').classList.remove('show');
  document.getElementById('ai-tool-result-actions').style.display='none';
  document.getElementById('ai-tool-thinking').classList.remove('show');
  const p=getActiveProvider();
  document.getElementById('ai-tool-provider-badge').textContent=`Usando: ${p==='oai'?'ğŸ’š ChatGPT':'ğŸ”µ Claude'}`;
  openModal('ai-tool-modal');
}
async function runAiTool(){
  const c=aiCfgs[_curTool]; if(!c)return;
  const inp=document.getElementById('ai-tool-modal-input').value.trim();
  if(!inp){showToast('âš ï¸ Preencha o campo.');return;}
  const th=document.getElementById('ai-tool-thinking'), re=document.getElementById('ai-tool-result'), ac=document.getElementById('ai-tool-result-actions');
  th.classList.add('show'); re.classList.remove('show'); ac.style.display='none';
  try{const t=await callAI([{role:'user',content:c.prompt(inp)}],2000); re.textContent=t; re.classList.add('show'); ac.style.display='flex'; showToast('âœ“ Resultado gerado!');}
  catch(e){re.textContent='âœ— '+e.message; re.classList.add('show'); if(e.message.includes('configurada'))openModal('api-key-modal');}
  finally{th.classList.remove('show');}
}
function copyAiResult(id){
  const t=document.getElementById(id).textContent;
  navigator.clipboard.writeText(t).then(()=>showToast('âœ“ Copiado!')).catch(()=>{const ta=document.createElement('textarea');ta.value=t;document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();showToast('âœ“ Copiado!');});
}
function sendToolResultToNew(){ const t=document.getElementById('ai-tool-result').textContent; closeModal('ai-tool-modal'); showPage('new-sermon'); setTimeout(()=>{document.getElementById('f-body').value=t;showToast('âœ“ ConteÃºdo enviado!');},100); }

// â”€â”€ INIT â”€â”€
updateAiStatus();
updateBadge();
renderDashboard();
renderPhotos();
</script>
</body>
</html>
