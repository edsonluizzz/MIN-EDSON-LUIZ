<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minist√©rio ‚Äî Edson Luiz</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0d0f;
    --surface: #16161a;
    --surface2: #1e1e24;
    --border: #2a2a35;
    --gold: #c9a84c;
    --gold2: #e8c97a;
    --text: #e8e6e0;
    --muted: #7a7888;
    --accent: #7b4fc4;
    --red: #c44f4f;
    --green: #4fc47a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Source Sans 3', sans-serif;
    min-height: 100vh;
    display: flex;
  }

  /* SIDEBAR */
  .sidebar {
    width: 240px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 0;
    position: fixed;
    height: 100vh;
    z-index: 100;
    transition: transform 0.3s;
  }

  .logo {
    padding: 28px 24px 20px;
    border-bottom: 1px solid var(--border);
  }

  .logo-cross {
    font-size: 22px;
    color: var(--gold);
    margin-bottom: 6px;
  }

  .logo h1 {
    font-family: 'Playfair Display', serif;
    font-size: 15px;
    font-weight: 700;
    color: var(--gold2);
    letter-spacing: 0.05em;
    line-height: 1.3;
  }

  .logo p {
    font-size: 11px;
    color: var(--muted);
    margin-top: 2px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }

  nav { padding: 16px 12px; flex: 1; }

  .nav-section {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    padding: 12px 12px 6px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    color: var(--muted);
    transition: all 0.2s;
    margin-bottom: 2px;
    border: 1px solid transparent;
  }

  .nav-item:hover { background: var(--surface2); color: var(--text); }
  .nav-item.active { background: rgba(201,168,76,0.12); color: var(--gold2); border-color: rgba(201,168,76,0.2); }
  .nav-item .icon { font-size: 16px; width: 20px; text-align: center; }

  .badge {
    margin-left: auto;
    background: var(--accent);
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 600;
  }

  /* MAIN */
  .main {
    margin-left: 240px;
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  .topbar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .topbar h2 {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    color: var(--text);
  }

  .topbar-actions { display: flex; gap: 10px; }

  .btn {
    padding: 9px 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    font-family: 'Source Sans 3', sans-serif;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .btn-primary { background: var(--gold); color: #0d0d0f; }
  .btn-primary:hover { background: var(--gold2); }
  .btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
  .btn-ghost:hover { color: var(--text); border-color: var(--text); }
  .btn-danger { background: rgba(196,79,79,0.15); color: var(--red); border: 1px solid rgba(196,79,79,0.3); }
  .btn-sm { padding: 6px 12px; font-size: 12px; }

  .content { padding: 32px; flex: 1; }

  /* PAGE */
  .page { display: none; }
  .page.active { display: block; }

  /* STATS */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--gold), transparent);
  }

  .stat-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 8px; }
  .stat-value { font-family: 'Playfair Display', serif; font-size: 32px; color: var(--gold2); }
  .stat-sub { font-size: 12px; color: var(--muted); margin-top: 4px; }

  /* CARDS */
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
  }

  .sermon-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }

  .sermon-card:hover { border-color: var(--gold); transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.4); }

  .sermon-card-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 3px 8px;
    border-radius: 4px;
    margin-bottom: 10px;
    font-weight: 600;
  }

  .tag-evangelismo { background: rgba(79,196,122,0.15); color: var(--green); }
  .tag-edificacao { background: rgba(123,79,196,0.15); color: #a47be8; }
  .tag-jovens { background: rgba(201,168,76,0.15); color: var(--gold); }
  .tag-batismo { background: rgba(79,130,196,0.15); color: #7baae8; }
  .tag-estudo { background: rgba(196,79,79,0.15); color: var(--red); }

  .sermon-card h3 {
    font-family: 'Playfair Display', serif;
    font-size: 17px;
    margin-bottom: 6px;
    line-height: 1.3;
  }

  .sermon-card .meta {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 10px;
    display: flex;
    gap: 12px;
  }

  .sermon-card .verse {
    font-size: 13px;
    color: var(--gold);
    font-style: italic;
    border-left: 2px solid var(--gold);
    padding-left: 10px;
    margin-bottom: 12px;
  }

  .sermon-card .excerpt {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .sermon-card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 14px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }

  .versions-badge {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 200;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: 100%;
    max-width: 780px;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .modal-header {
    padding: 24px 28px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    background: var(--surface);
    z-index: 10;
  }

  .modal-header h3 {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
  }

  .modal-close {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 20px;
    cursor: pointer;
    padding: 4px;
    transition: color 0.2s;
  }

  .modal-close:hover { color: var(--text); }

  .modal-body { padding: 24px 28px; }

  /* FORM */
  .form-grid { display: grid; gap: 16px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-group.full { grid-column: 1 / -1; }

  label { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; }

  input, select, textarea {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'Source Sans 3', sans-serif;
    font-size: 14px;
    transition: border-color 0.2s;
    width: 100%;
  }

  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--gold);
  }

  select option { background: var(--surface2); }

  textarea { resize: vertical; min-height: 120px; line-height: 1.6; }

  .editor-toolbar {
    display: flex;
    gap: 4px;
    padding: 8px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-bottom: none;
    border-radius: 8px 8px 0 0;
    flex-wrap: wrap;
  }

  .editor-toolbar button {
    background: none;
    border: 1px solid transparent;
    color: var(--muted);
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.15s;
  }

  .editor-toolbar button:hover { background: var(--surface2); color: var(--text); border-color: var(--border); }

  .editor-area {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 0 0 8px 8px;
    padding: 14px;
    min-height: 200px;
    color: var(--text);
    font-size: 14px;
    line-height: 1.8;
    outline: none;
    font-family: 'Source Sans 3', sans-serif;
  }

  .editor-area:focus { border-color: var(--gold); }

  /* VERSIONS */
  .versions-list { margin-top: 16px; }
  .version-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 6px;
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .version-item:hover { border-color: var(--gold); }
  .version-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--gold); flex-shrink: 0; }
  .version-info { flex: 1; }
  .version-name { font-size: 13px; font-weight: 600; }
  .version-date { font-size: 11px; color: var(--muted); }

  /* LOCATIONS */
  .location-list { display: flex; flex-direction: column; gap: 8px; }
  .location-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
  }

  .location-icon { font-size: 20px; }
  .location-info h4 { font-size: 14px; font-weight: 600; }
  .location-info p { font-size: 12px; color: var(--muted); }
  .location-count { margin-left: auto; font-size: 12px; color: var(--gold); font-weight: 600; }

  /* SEARCH */
  .search-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 16px;
    margin-bottom: 24px;
  }

  .search-bar input {
    background: none;
    border: none;
    padding: 0;
    flex: 1;
    font-size: 14px;
  }

  .search-bar input:focus { outline: none; border: none; }

  /* FILTER TABS */
  .filter-tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .filter-tab {
    padding: 7px 14px;
    border-radius: 6px;
    font-size: 13px;
    cursor: pointer;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-family: 'Source Sans 3', sans-serif;
    transition: all 0.2s;
  }

  .filter-tab:hover { color: var(--text); border-color: var(--text); }
  .filter-tab.active { background: rgba(201,168,76,0.15); color: var(--gold); border-color: rgba(201,168,76,0.4); }

  /* STUDY PAGE */
  .study-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

  .study-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .study-card:hover { border-color: var(--gold); }

  .study-card h4 {
    font-family: 'Playfair Display', serif;
    font-size: 16px;
    margin-bottom: 6px;
  }

  .study-card p { font-size: 13px; color: var(--muted); line-height: 1.5; }

  .study-card .tags { display: flex; gap: 6px; margin-top: 12px; flex-wrap: wrap; }

  /* UPLOAD */
  .upload-area {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--muted);
  }

  .upload-area:hover { border-color: var(--gold); color: var(--text); background: rgba(201,168,76,0.04); }
  .upload-area .upload-icon { font-size: 32px; margin-bottom: 10px; }
  .upload-area p { font-size: 13px; }

  .photo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 8px;
    margin-top: 16px;
  }

  .photo-item {
    aspect-ratio: 1;
    border-radius: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    overflow: hidden;
    cursor: pointer;
    transition: opacity 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--muted);
  }

  .photo-item img { width: 100%; height: 100%; object-fit: cover; }

  /* DETAIL VIEW */
  .detail-view { display: none; }
  .detail-view.open { display: block; }

  .detail-back {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--muted);
    cursor: pointer;
    font-size: 14px;
    margin-bottom: 24px;
    transition: color 0.2s;
  }

  .detail-back:hover { color: var(--gold); }

  .detail-header {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 20px;
  }

  .detail-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    margin-bottom: 10px;
    line-height: 1.3;
  }

  .detail-body { 
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    line-height: 1.8;
    font-size: 15px;
  }

  /* SECTION DIVIDER */
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    color: var(--text);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

  .empty-state .empty-icon { font-size: 48px; margin-bottom: 12px; }
  .empty-state p { font-size: 15px; }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--surface2);
    border: 1px solid var(--gold);
    border-radius: 10px;
    padding: 14px 20px;
    font-size: 14px;
    color: var(--gold2);
    z-index: 999;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s;
  }

  .toast.show { transform: translateY(0); opacity: 1; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

  @media (max-width: 900px) {
    .stats-grid { grid-template-columns: repeat(2,1fr); }
    .form-row { grid-template-columns: 1fr; }
    .study-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-cross">‚úù</div>
    <h1>Minist√©rio<br>Edson Luiz</h1>
    <p>Gest√£o Ministerial</p>
  </div>
  <nav>
    <div class="nav-section">Principal</div>
    <div class="nav-item active" onclick="showPage('dashboard')">
      <span class="icon">‚äû</span> Dashboard
    </div>
    <div class="nav-item" onclick="showPage('sermons')">
      <span class="icon">üìñ</span> Mensagens
      <span class="badge" id="sermon-count">0</span>
    </div>
    <div class="nav-item" onclick="showPage('new-sermon')">
      <span class="icon">‚úèÔ∏è</span> Nova Mensagem
    </div>

    <div class="nav-section">Organiza√ß√£o</div>
    <div class="nav-item" onclick="showPage('locations')">
      <span class="icon">üìç</span> Locais
    </div>
    <div class="nav-item" onclick="showPage('studies')">
      <span class="icon">üìö</span> Estudos B√≠blicos
    </div>
    <div class="nav-item" onclick="showPage('photos')">
      <span class="icon">üñºÔ∏è</span> Fotos
    </div>
  </nav>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <h2 id="page-title">Dashboard</h2>
    <div class="topbar-actions">
      <button class="btn btn-ghost" onclick="document.getElementById('import-json').click()">‚Üë Importar JSON</button>
      <input type="file" id="import-json" accept=".json" style="display:none" onchange="importData(this)">
      <button class="btn btn-ghost" onclick="exportData()">‚Üì Exportar</button>
      <button class="btn btn-primary" onclick="showPage('new-sermon')">+ Nova Mensagem</button>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD -->
    <div id="page-dashboard" class="page active">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total de Mensagens</div>
          <div class="stat-value" id="stat-total">0</div>
          <div class="stat-sub">Prega√ß√µes registradas</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Locais Ministrados</div>
          <div class="stat-value" id="stat-locations">0</div>
          <div class="stat-sub">Igrejas e eventos</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Estudos Ativos</div>
          <div class="stat-value" id="stat-studies">0</div>
          <div class="stat-sub">Em desenvolvimento</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Este M√™s</div>
          <div class="stat-value" id="stat-month">0</div>
          <div class="stat-sub">Prega√ß√µes no m√™s atual</div>
        </div>
      </div>

      <div class="section-title">‚úù √öltimas Mensagens</div>
      <div class="card-grid" id="dashboard-recent"></div>
    </div>

    <!-- SERMONS LIST -->
    <div id="page-sermons" class="page">
      <div class="search-bar">
        <span>üîç</span>
        <input type="text" placeholder="Buscar por t√≠tulo, texto b√≠blico ou local..." oninput="filterSermons(this.value)" id="sermon-search">
      </div>
      <div class="filter-tabs">
        <button class="filter-tab active" onclick="setFilter('all', this)">Todas</button>
        <button class="filter-tab" onclick="setFilter('evangelismo', this)">Evangelismo</button>
        <button class="filter-tab" onclick="setFilter('edificacao', this)">Edifica√ß√£o</button>
        <button class="filter-tab" onclick="setFilter('jovens', this)">Jovens</button>
        <button class="filter-tab" onclick="setFilter('batismo', this)">Batismo</button>
        <button class="filter-tab" onclick="setFilter('estudo', this)">Estudo</button>
      </div>
      <div class="card-grid" id="sermons-grid"></div>
    </div>

    <!-- SERMON DETAIL -->
    <div id="page-sermon-detail" class="page">
      <div class="detail-back" onclick="showPage('sermons')">‚Üê Voltar para mensagens</div>
      <div class="detail-header" id="detail-header"></div>
      <div class="detail-body" id="detail-content"></div>
    </div>

    <!-- NEW SERMON -->
    <div id="page-new-sermon" class="page">

      <!-- PASTE IMPORT HELPER -->
      <div style="background:rgba(201,168,76,0.07);border:1px solid rgba(201,168,76,0.25);border-radius:12px;padding:20px;margin-bottom:24px;">
        <div style="font-size:13px;font-weight:600;color:var(--gold2);margin-bottom:6px;">üìã Importar texto do Word, PDF ou WhatsApp</div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:12px;">Cole o conte√∫do da sua mensagem abaixo. A aplica√ß√£o vai distribuir automaticamente nos campos do formul√°rio.</div>
        <textarea id="paste-raw" placeholder="Cole aqui o texto completo da sua mensagem...&#10;&#10;Pode ser do Word, PDF, WhatsApp ou qualquer anota√ß√£o. Cole tudo ‚Äî t√≠tulo, vers√≠culos, pontos e conclus√£o." style="min-height:100px;margin-bottom:10px;"></textarea>
        <div style="display:flex;gap:8px;align-items:center;">
          <button class="btn btn-primary btn-sm" onclick="parseRawText()">‚ö° Distribuir nos campos</button>
          <span style="font-size:11px;color:var(--muted)">Voc√™ pode ajustar tudo depois nos campos abaixo</span>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-row">
          <div class="form-group">
            <label>T√≠tulo da Mensagem</label>
            <input type="text" id="f-title" placeholder="Ex: A For√ßa do Esp√≠rito Santo">
          </div>
          <div class="form-group">
            <label>Texto B√≠blico Principal</label>
            <input type="text" id="f-verse" placeholder="Ex: Atos 2:1-4">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Data da Prega√ß√£o</label>
            <input type="date" id="f-date">
          </div>
          <div class="form-group">
            <label>Local / Igreja</label>
            <input type="text" id="f-location" placeholder="Ex: Igreja Assembleia Central">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Categoria</label>
            <select id="f-category">
              <option value="evangelismo">Evangelismo</option>
              <option value="edificacao">Edifica√ß√£o</option>
              <option value="jovens">Jovens</option>
              <option value="batismo">Batismo</option>
              <option value="estudo">Estudo B√≠blico</option>
            </select>
          </div>
          <div class="form-group">
            <label>Vers√£o</label>
            <input type="text" id="f-version" placeholder="Ex: Vers√£o Original, Revisada 2024...">
          </div>
        </div>
        <div class="form-group full">
          <label>Tema Central / Introdu√ß√£o</label>
          <input type="text" id="f-theme" placeholder="Resumo do tema central da mensagem">
        </div>
        <div class="form-group full">
          <label>Corpo da Mensagem</label>
          <div class="editor-toolbar">
            <button onclick="formatText('bold')"><b>N</b></button>
            <button onclick="formatText('italic')"><i>I</i></button>
            <button onclick="insertText('üìå PONTO: ')">üìå Ponto</button>
            <button onclick="insertText('\n\nüî• CL√çMAX: ')">üî• Cl√≠max</button>
            <button onclick="insertText('\n\nüí° ILUSTRA√á√ÉO: ')">üí° Ilustra√ß√£o</button>
            <button onclick="insertText('\n\nüì£ APELO: ')">üì£ Apelo</button>
            <button onclick="insertText('\n\nüôè ORA√á√ÉO FINAL: ')">üôè Ora√ß√£o</button>
            <button onclick="insertText('\n\n‚ë† ')">‚ë† T√≥pico</button>
            <button onclick="insertText('\n‚ë° ')">‚ë° T√≥pico</button>
            <button onclick="insertText('\n‚ë¢ ')">‚ë¢ T√≥pico</button>
          </div>
          <textarea id="f-body" placeholder="Desenvolva aqui o corpo completo da mensagem...&#10;&#10;Utilize os bot√µes acima para estruturar os pontos, cl√≠max e apelos." style="border-radius:0 0 8px 8px; min-height:280px;"></textarea>
        </div>
        <div class="form-group full">
          <label>Notas Pessoais / Observa√ß√µes</label>
          <textarea id="f-notes" placeholder="Rea√ß√µes da congrega√ß√£o, insights, o que funcionou, o que melhorar..." style="min-height:80px;"></textarea>
        </div>
        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:8px;">
          <button class="btn btn-ghost" onclick="showPage('sermons')">Cancelar</button>
          <button class="btn btn-primary" onclick="saveSermon()">‚úì Salvar Mensagem</button>
        </div>
      </div>
    </div>

    <!-- LOCATIONS -->
    <div id="page-locations" class="page">
      <div class="section-title" style="margin-bottom:20px">üìç Locais Ministrados</div>
      <div class="location-list" id="locations-list">
        <div class="empty-state">
          <div class="empty-icon">üìç</div>
          <p>Nenhum local registrado ainda.</p>
          <p style="margin-top:6px;font-size:13px">Os locais aparecer√£o aqui conforme voc√™ registra mensagens.</p>
        </div>
      </div>
    </div>

    <!-- STUDIES -->
    <div id="page-studies" class="page">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div class="section-title" style="flex:1;margin-bottom:0">üìö Estudos B√≠blicos</div>
        <button class="btn btn-primary btn-sm" onclick="openStudyModal()">+ Novo Estudo</button>
      </div>
      <div class="study-grid" id="studies-grid">
        <div class="empty-state" style="grid-column:1/-1">
          <div class="empty-icon">üìö</div>
          <p>Nenhum estudo registrado ainda.</p>
        </div>
      </div>
    </div>

    <!-- PHOTOS -->
    <div id="page-photos" class="page">
      <div class="section-title" style="margin-bottom:20px">üñºÔ∏è Galeria Ministerial</div>
      <div class="upload-area" onclick="document.getElementById('photo-input').click()">
        <div class="upload-icon">üì∑</div>
        <p>Clique para adicionar fotos de eventos e prega√ß√µes</p>
        <p style="font-size:11px;margin-top:6px">PNG, JPG, WebP</p>
        <input type="file" id="photo-input" accept="image/*" multiple style="display:none" onchange="handlePhotos(this)">
      </div>
      <div class="photo-grid" id="photo-grid"></div>
    </div>

  </div>
</main>

<!-- MODALS -->
<div class="modal-overlay" id="sermon-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="modal-title">Mensagem</h3>
      <button class="modal-close" onclick="closeModal('sermon-modal')">‚úï</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<div class="modal-overlay" id="study-modal">
  <div class="modal">
    <div class="modal-header">
      <h3>Novo Estudo B√≠blico</h3>
      <button class="modal-close" onclick="closeModal('study-modal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>T√≠tulo do Estudo</label>
          <input type="text" id="sf-title" placeholder="Ex: O Batismo com o Esp√≠rito Santo">
        </div>
        <div class="form-group">
          <label>Livro / Passagem Base</label>
          <input type="text" id="sf-passage" placeholder="Ex: Atos 2">
        </div>
        <div class="form-group full">
          <label>Desenvolvimento</label>
          <textarea id="sf-content" placeholder="Desenvolva seu estudo aqui..." style="min-height:200px;"></textarea>
        </div>
        <div class="form-group full">
          <label>Palavras-chave / Tags</label>
          <input type="text" id="sf-tags" placeholder="Ex: Esp√≠rito Santo, Dons, Pentecostes">
        </div>
        <div style="display:flex;gap:10px;justify-content:flex-end">
          <button class="btn btn-ghost" onclick="closeModal('study-modal')">Cancelar</button>
          <button class="btn btn-primary" onclick="saveStudy()">‚úì Salvar Estudo</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
let data = JSON.parse(localStorage.getItem('ministerio') || '{"sermons":[],"studies":[],"photos":[]}');
let activeFilter = 'all';

function save() { localStorage.setItem('ministerio', JSON.stringify(data)); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

  const titles = {
    'dashboard': 'Dashboard', 'sermons': 'Mensagens', 'new-sermon': 'Nova Mensagem',
    'locations': 'Locais Ministrados', 'studies': 'Estudos B√≠blicos', 'photos': 'Galeria de Fotos',
    'sermon-detail': 'Mensagem'
  };
  document.getElementById('page-title').textContent = titles[id] || '';

  if (id === 'dashboard') renderDashboard();
  if (id === 'sermons') renderSermons();
  if (id === 'locations') renderLocations();
  if (id === 'studies') renderStudies();
  if (id === 'new-sermon') {
    clearForm();
    document.getElementById('f-date').value = new Date().toISOString().split('T')[0];
  }
}

function clearForm() {
  ['f-title','f-verse','f-location','f-version','f-theme','f-body','f-notes'].forEach(id => {
    document.getElementById(id).value = '';
  });
  document.getElementById('f-category').value = 'evangelismo';
  document.getElementById('f-version').value = 'Vers√£o Original';
}

function formatText(cmd) { document.execCommand(cmd); }

function insertText(txt) {
  const ta = document.getElementById('f-body');
  const pos = ta.selectionStart;
  ta.value = ta.value.substring(0, pos) + txt + ta.value.substring(pos);
  ta.selectionStart = ta.selectionEnd = pos + txt.length;
  ta.focus();
}

function saveSermon() {
  const title = document.getElementById('f-title').value.trim();
  if (!title) { showToast('‚ö†Ô∏è Informe o t√≠tulo da mensagem.'); return; }
  const sermon = {
    id: Date.now(),
    title,
    verse: document.getElementById('f-verse').value.trim(),
    date: document.getElementById('f-date').value,
    location: document.getElementById('f-location').value.trim(),
    category: document.getElementById('f-category').value,
    theme: document.getElementById('f-theme').value.trim(),
    body: document.getElementById('f-body').value.trim(),
    notes: document.getElementById('f-notes').value.trim(),
    versions: [{ name: document.getElementById('f-version').value || 'Vers√£o Original', date: new Date().toISOString(), body: document.getElementById('f-body').value.trim() }]
  };
  data.sermons.unshift(sermon);
  save();
  updateBadge();
  showToast('‚úù Mensagem salva com sucesso!');
  showPage('sermons');
}

function updateBadge() {
  document.getElementById('sermon-count').textContent = data.sermons.length;
}

function renderDashboard() {
  document.getElementById('stat-total').textContent = data.sermons.length;
  const locs = [...new Set(data.sermons.map(s => s.location).filter(Boolean))];
  document.getElementById('stat-locations').textContent = locs.length;
  document.getElementById('stat-studies').textContent = data.studies.length;
  const now = new Date();
  const monthCount = data.sermons.filter(s => {
    if (!s.date) return false;
    const d = new Date(s.date);
    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
  }).length;
  document.getElementById('stat-month').textContent = monthCount;

  const container = document.getElementById('dashboard-recent');
  const recent = data.sermons.slice(0, 6);
  if (!recent.length) {
    container.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">‚úù</div><p>Nenhuma mensagem registrada ainda.</p><p style="margin-top:10px;"><button class="btn btn-primary" onclick="showPage('new-sermon')">Registrar Primeira Mensagem</button></p></div>`;
  } else {
    container.innerHTML = recent.map(s => sermonCard(s)).join('');
  }
}

function sermonCard(s) {
  const catLabels = { evangelismo:'Evangelismo', edificacao:'Edifica√ß√£o', jovens:'Jovens', batismo:'Batismo', estudo:'Estudo' };
  const dateStr = s.date ? new Date(s.date + 'T12:00').toLocaleDateString('pt-BR') : '';
  return `
  <div class="sermon-card" onclick="openSermon(${s.id})">
    <div class="sermon-card-tag tag-${s.category}">${catLabels[s.category] || s.category}</div>
    <h3>${s.title}</h3>
    <div class="meta">
      ${dateStr ? `<span>üìÖ ${dateStr}</span>` : ''}
      ${s.location ? `<span>üìç ${s.location}</span>` : ''}
    </div>
    ${s.verse ? `<div class="verse">${s.verse}</div>` : ''}
    ${s.theme ? `<div class="excerpt">${s.theme}</div>` : ''}
    <div class="sermon-card-footer">
      <span class="versions-badge">üìÑ ${s.versions ? s.versions.length : 1} vers√£o(√µes)</span>
      <span style="font-size:12px;color:var(--gold)">Ver mensagem ‚Üí</span>
    </div>
  </div>`;
}

let currentFilter = 'all', currentSearch = '';

function renderSermons() {
  let list = data.sermons;
  if (currentFilter !== 'all') list = list.filter(s => s.category === currentFilter);
  if (currentSearch) {
    const q = currentSearch.toLowerCase();
    list = list.filter(s =>
      s.title.toLowerCase().includes(q) ||
      (s.verse || '').toLowerCase().includes(q) ||
      (s.location || '').toLowerCase().includes(q) ||
      (s.theme || '').toLowerCase().includes(q)
    );
  }
  const g = document.getElementById('sermons-grid');
  if (!list.length) {
    g.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üîç</div><p>Nenhuma mensagem encontrada.</p></div>`;
  } else {
    g.innerHTML = list.map(s => sermonCard(s)).join('');
  }
}

function filterSermons(val) { currentSearch = val; renderSermons(); }
function setFilter(val, el) {
  currentFilter = val;
  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderSermons();
}

function openSermon(id) {
  const s = data.sermons.find(x => x.id === id);
  if (!s) return;
  const catLabels = { evangelismo:'Evangelismo', edificacao:'Edifica√ß√£o', jovens:'Jovens', batismo:'Batismo', estudo:'Estudo' };
  const dateStr = s.date ? new Date(s.date + 'T12:00').toLocaleDateString('pt-BR', { weekday:'long', year:'numeric', month:'long', day:'numeric' }) : '';
  document.getElementById('detail-header').innerHTML = `
    <div class="sermon-card-tag tag-${s.category}" style="margin-bottom:14px">${catLabels[s.category] || s.category}</div>
    <h2>${s.title}</h2>
    <div class="meta" style="margin-top:10px;margin-bottom:${s.verse ? '14px':'0'}">
      ${dateStr ? `<span>üìÖ ${dateStr}</span>` : ''}
      ${s.location ? `<span>üìç ${s.location}</span>` : ''}
    </div>
    ${s.verse ? `<div class="verse" style="margin-top:10px">${s.verse}</div>` : ''}
    <div style="display:flex;gap:8px;margin-top:14px">
      <button class="btn btn-ghost btn-sm" onclick="addVersion(${s.id})">+ Nova Vers√£o</button>
      <button class="btn btn-danger btn-sm" onclick="deleteSermon(${s.id})">üóë Excluir</button>
    </div>
  `;
  const body = s.body ? s.body.replace(/\n/g,'<br>') : '<em style="color:var(--muted)">Nenhum conte√∫do registrado.</em>';
  let versionsHtml = '';
  if (s.versions && s.versions.length > 1) {
    versionsHtml = `<div style="margin-top:24px;border-top:1px solid var(--border);padding-top:20px">
      <div class="section-title" style="margin-bottom:12px">üìÑ Vers√µes Anteriores</div>
      ${s.versions.slice(1).map((v,i) => `
        <div class="version-item" onclick="viewVersion(${s.id},${i+1})">
          <div class="version-dot"></div>
          <div class="version-info">
            <div class="version-name">${v.name}</div>
            <div class="version-date">${new Date(v.date).toLocaleDateString('pt-BR')}</div>
          </div>
          <span style="font-size:12px;color:var(--muted)">Ver ‚Üí</span>
        </div>`).join('')}
    </div>`;
  }
  const notesHtml = s.notes ? `<div style="margin-top:24px;border-top:1px solid var(--border);padding-top:20px"><div class="section-title" style="margin-bottom:10px">üìù Notas Pessoais</div><p style="color:var(--muted);font-size:14px;line-height:1.7">${s.notes.replace(/\n/g,'<br>')}</p></div>` : '';
  document.getElementById('detail-content').innerHTML = body + versionsHtml + notesHtml;
  document.getElementById('page-title').textContent = s.title;
  showPage('sermon-detail');
}

function addVersion(id) {
  const name = prompt('Nome desta vers√£o (ex: Vers√£o Revisada 2025):');
  if (!name) return;
  const s = data.sermons.find(x => x.id === id);
  if (!s) return;
  const body = prompt('Cole o novo texto ou pressione Enter para usar o atual:') || s.body;
  s.versions = s.versions || [];
  s.versions.push({ name, date: new Date().toISOString(), body });
  save();
  showToast('‚úì Nova vers√£o salva!');
  openSermon(id);
}

function viewVersion(sermonId, vIdx) {
  const s = data.sermons.find(x => x.id === sermonId);
  if (!s || !s.versions[vIdx]) return;
  const v = s.versions[vIdx];
  document.getElementById('modal-title').textContent = v.name;
  document.getElementById('modal-body').innerHTML = `<p style="color:var(--muted);font-size:13px;margin-bottom:16px">Salva em ${new Date(v.date).toLocaleDateString('pt-BR')}</p>${v.body ? v.body.replace(/\n/g,'<br>') : '<em>Sem conte√∫do.</em>'}`;
  openModal('sermon-modal');
}

function deleteSermon(id) {
  if (!confirm('Excluir esta mensagem permanentemente?')) return;
  data.sermons = data.sermons.filter(s => s.id !== id);
  save();
  updateBadge();
  showToast('‚úì Mensagem exclu√≠da.');
  showPage('sermons');
}

function renderLocations() {
  const container = document.getElementById('locations-list');
  const locMap = {};
  data.sermons.forEach(s => { if (s.location) { locMap[s.location] = (locMap[s.location] || 0) + 1; } });
  const locs = Object.entries(locMap).sort((a,b) => b[1]-a[1]);
  if (!locs.length) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">üìç</div><p>Nenhum local registrado ainda.</p></div>`;
    return;
  }
  container.innerHTML = locs.map(([loc, count]) => `
    <div class="location-item">
      <div class="location-icon">üèõÔ∏è</div>
      <div class="location-info">
        <h4>${loc}</h4>
        <p>${count} prega√ß√£o(√µes)</p>
      </div>
      <div class="location-count">${count}x</div>
    </div>`).join('');
}

function renderStudies() {
  const g = document.getElementById('studies-grid');
  if (!data.studies.length) {
    g.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üìö</div><p>Nenhum estudo registrado ainda.</p></div>`;
    return;
  }
  g.innerHTML = data.studies.map(s => `
    <div class="study-card">
      <h4>${s.title}</h4>
      <p>${s.passage || ''}</p>
      <p style="margin-top:8px;font-size:13px;color:var(--muted);line-height:1.5">${(s.content || '').substring(0,120)}...</p>
      <div class="tags">
        ${(s.tags || '').split(',').filter(Boolean).map(t => `<span class="sermon-card-tag tag-estudo">${t.trim()}</span>`).join('')}
      </div>
    </div>`).join('');
}

function openStudyModal() { openModal('study-modal'); }

function saveStudy() {
  const title = document.getElementById('sf-title').value.trim();
  if (!title) { showToast('‚ö†Ô∏è Informe o t√≠tulo do estudo.'); return; }
  data.studies.push({
    id: Date.now(),
    title,
    passage: document.getElementById('sf-passage').value.trim(),
    content: document.getElementById('sf-content').value.trim(),
    tags: document.getElementById('sf-tags').value.trim(),
    date: new Date().toISOString()
  });
  save();
  closeModal('study-modal');
  showToast('‚úì Estudo salvo!');
  renderStudies();
  ['sf-title','sf-passage','sf-content','sf-tags'].forEach(id => document.getElementById(id).value = '');
}

function handlePhotos(input) {
  const files = Array.from(input.files);
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      data.photos.push({ id: Date.now() + Math.random(), src: e.target.result, name: file.name, date: new Date().toISOString() });
      save();
      renderPhotos();
      showToast('üì∑ Foto adicionada!');
    };
    reader.readAsDataURL(file);
  });
}

function renderPhotos() {
  const g = document.getElementById('photo-grid');
  if (!data.photos.length) { g.innerHTML = ''; return; }
  g.innerHTML = data.photos.map(p => `
    <div class="photo-item" title="${p.name}">
      <img src="${p.src}" alt="${p.name}">
    </div>`).join('');
}

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) closeModal(m.id); });
});

function exportData() {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `ministerio-edson-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  showToast('‚úì Dados exportados!');
}

function parseRawText() {
  const raw = document.getElementById('paste-raw').value.trim();
  if (!raw) { showToast('‚ö†Ô∏è Cole algum texto primeiro.'); return; }

  // Try to detect title: first non-empty line
  const lines = raw.split('\n').map(l => l.trim()).filter(Boolean);
  if (!lines.length) return;

  // Title = first line (up to 120 chars)
  const title = lines[0].substring(0, 120);
  document.getElementById('f-title').value = title;

  // Try to detect Bible verse: line matching book + chapter:verse pattern
  const verseRegex = /([1-3]?\s?[A-Za-z√Ä-√∫]+\.?\s?\d+\s?:\s?\d+[\s\-‚Äì‚Äî\d,;]*)/;
  let verse = '';
  for (const line of lines) {
    const match = line.match(verseRegex);
    if (match) { verse = match[0].trim(); break; }
  }
  if (verse) document.getElementById('f-verse').value = verse;

  // Try to detect date: dd/mm/yyyy or yyyy-mm-dd
  const dateRegexBR = /(\d{2})[\/\-](\d{2})[\/\-](\d{4})/;
  const dateRegexISO = /(\d{4})[\/\-](\d{2})[\/\-](\d{2})/;
  for (const line of lines) {
    const mBR = line.match(dateRegexBR);
    if (mBR) {
      document.getElementById('f-date').value = `${mBR[3]}-${mBR[2]}-${mBR[1]}`;
      break;
    }
    const mISO = line.match(dateRegexISO);
    if (mISO) {
      document.getElementById('f-date').value = `${mISO[1]}-${mISO[2]}-${mISO[3]}`;
      break;
    }
  }

  // Theme = second non-title line if short (< 160 chars), else empty
  const secondLine = lines.find((l, i) => i > 0 && l !== verse && l.length < 160);
  if (secondLine) document.getElementById('f-theme').value = secondLine;

  // Body = everything from line 2 onward joined
  const bodyLines = lines.slice(1);
  document.getElementById('f-body').value = bodyLines.join('\n');

  // Set version name
  if (!document.getElementById('f-version').value) {
    document.getElementById('f-version').value = 'Vers√£o Original';
  }

  // Scroll to form
  document.getElementById('f-title').scrollIntoView({ behavior: 'smooth', block: 'center' });
  showToast('‚úì Texto distribu√≠do! Revise e ajuste os campos.');
}

function importData(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const imported = JSON.parse(e.target.result);
      if (!imported.sermons) { showToast('‚ö†Ô∏è Arquivo inv√°lido.'); return; }
      const count = imported.sermons.length;
      if (!confirm(`Importar ${count} mensagem(ns)? Os dados existentes ser√£o mantidos.`)) return;
      // Merge: add only sermons not already present (by id)
      const existingIds = new Set(data.sermons.map(s => s.id));
      let added = 0;
      imported.sermons.forEach(s => {
        if (!existingIds.has(s.id)) { data.sermons.push(s); added++; }
      });
      if (imported.studies) {
        const existStudyIds = new Set(data.studies.map(s => s.id));
        imported.studies.forEach(s => { if (!existStudyIds.has(s.id)) data.studies.push(s); });
      }
      save();
      updateBadge();
      renderDashboard();
      showToast(`‚úì ${added} mensagem(ns) importada(s)!`);
    } catch {
      showToast('‚ö†Ô∏è Erro ao ler o arquivo JSON.');
    }
    input.value = '';
  };
  reader.readAsText(file);
}

// INIT
updateBadge();
renderDashboard();
renderPhotos();
</script>
</body>
</html>
